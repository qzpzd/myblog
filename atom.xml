<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>ä¸¤ä¸ªä¸–ç•Œçš„æˆ‘</title>
  
  <subtitle>qzpzdçš„ä¸ªäººåšå®¢</subtitle>
  <link href="https://qzpzd.github.io/myblog/atom.xml" rel="self"/>
  
  <link href="https://qzpzd.github.io/myblog/"/>
  <updated>2023-10-12T11:19:09.460Z</updated>
  <id>https://qzpzd.github.io/myblog/</id>
  
  <author>
    <name>guzhongyue666</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>(äº”)yolov5ä¿®æ”¹æ£€æµ‹å¤´detectä¸ºASFF(è‡ªé€‚åº”ç‰¹å¾èåˆ)|æ¶¨ç‚¹</title>
    <link href="https://qzpzd.github.io/myblog/2023/10/12/yolov5_detect/"/>
    <id>https://qzpzd.github.io/myblog/2023/10/12/yolov5_detect/</id>
    <published>2023-10-12T06:51:35.000Z</published>
    <updated>2023-10-12T11:19:09.460Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/myblog/css/APlayer.min.css"><script src="/myblog/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/myblog/js/Meting.min.js"></script><p>ASFFï¼šAdaptively Spatial Feature Fusion (è‡ªé€‚åº”ç©ºé—´ç‰¹å¾èåˆ)<br>è®ºæ–‡æ¥æºï¼šLearning Spatial Fusion for Single-Shot Object Detection</p><h1 id="1-èƒŒæ™¯"><a href="#1-èƒŒæ™¯" class="headerlink" title="1.èƒŒæ™¯"></a>1.èƒŒæ™¯</h1><p>ä¸åŒç‰¹å¾å°ºåº¦ä¹‹é—´çš„ä¸ä¸€è‡´æ€§æ˜¯åŸºäºç‰¹å¾é‡‘å­—å¡”çš„å•é˜¶æ®µæ£€æµ‹å™¨çš„ä¸»è¦ç¼ºé™·ã€‚</p><p>æœ¬æ–‡æå‡ºäº†ä¸€ç§æ–°çš„åŸºäºæ•°æ®é©±åŠ¨çš„é‡‘å­—å¡”ç‰¹å¾èåˆç­–ç•¥ï¼Œç§°ä¸ºè‡ªé€‚åº”ç©ºé—´ç‰¹å¾èåˆï¼ˆASFFï¼‰ã€‚å®ƒå­¦ä¹ äº†ç©ºé—´è¿‡æ»¤å†²çªä¿¡æ¯çš„æ–¹æ³•æ¥æŠ‘åˆ¶ä¸ä¸€è‡´æ€§ï¼Œä»è€Œæé«˜äº†ç‰¹å¾çš„å°ºåº¦ä¸å˜æ€§ï¼Œå¹¶ä¸”å¼€é”€å°ã€‚</p><p>æ‰€æå‡ºçš„æ–¹æ³•ä½¿ç½‘ç»œèƒ½ç›´æ¥å­¦ä¹ å¦‚ä½•åœ¨ç©ºé—´ä¸Šè¿‡æ»¤å…¶ä»–å±‚æ¬¡çš„ç‰¹å¾ï¼Œä»¥ä¾¿åªä¿ç•™æœ‰ç”¨çš„ä¿¡æ¯è¿›è¡Œç»„åˆã€‚åœ¨æ¯ä¸ªç©ºé—´ä½ç½®ï¼Œä¸åŒå±‚æ¬¡çš„ç‰¹å¾è¢«è‡ªé€‚åº”åœ°èåˆï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€äº›ç‰¹å¾åœ¨è¿™ä¸ªä½ç½®æºå¸¦çŸ›ç›¾çš„ä¿¡æ¯æ—¶å¯èƒ½è¢«è¿‡æ»¤æ‰ï¼Œè€Œä¸€äº›ç‰¹å¾å¯èƒ½ä»¥æ›´å…·äº‰è®®æ€§çš„çº¿ç´¢æ”¯é…ã€‚</p><p>æå‡ºä¸€ç§è‡ªé€‚åº”ç‰¹å¾èåˆæ–¹æ³•ï¼ŒASFF<br>ASFFå¯ä»¥æé«˜FPNå½¢å¼ç½‘ç»œçš„æ€§èƒ½<br>å€ŸåŠ©ASFFç­–ç•¥å’Œå¯é çš„YOLOv3åŸºçº¿ï¼Œåœ¨MS COCOæ•°æ®é›†ä¸Šå®ç°äº†æœ€ä½³çš„é€Ÿåº¦ç²¾åº¦æŠ˜è¡·<br>è§£å†³å•å‘æ£€æµ‹å™¨ç‰¹å¾é‡‘å­—å¡”çš„ä¸ä¸€è‡´æ€§ã€‚</p><p>ç‰¹å¾é‡‘å­—å¡”çš„ä¸€å¤§ç¼ºç‚¹æ˜¯ä¸åŒå°ºåº¦ç‰¹å¾çš„ä¸ä¸€è‡´æ€§ï¼Œç‰¹åˆ«æ˜¯å¯¹äºä¸€é˜¶æ®µæ£€æµ‹å™¨ã€‚ç¡®åˆ‡åœ°è¯´ï¼Œåœ¨FPNå½¢å¼çš„ç½‘ç»œä¸­å¯å‘å¼åœ°é€‰æ‹©ç‰¹å¾ï¼Œé«˜å±‚è¯­ä¹‰ä¿¡æ¯ä¸­æ£€æµ‹å¤§ç›®æ ‡ã€ä½å±‚è¯­ä¹‰ä¿¡æ¯ä¸­æ£€æµ‹å°ç›®æ ‡ã€‚å½“æŸä¸ªç›®æ ‡åœ¨æŸä¸€å±‚è¢«å½“åšæ­£ç±»æ—¶ï¼Œç›¸åº”åœ°è¯¥ç›®æ ‡åŒºåŸŸåœ¨å…¶å®ƒå±‚è¢«å½“åšè´Ÿç±»ã€‚å¦‚æœä¸€å¹…å›¾åƒä¸­æ—¢æœ‰å¤§ç›®æ ‡ä¹Ÿæœ‰å°ç›®æ ‡ï¼Œé‚£ä¹ˆä¸åŒå±‚é—´çš„ç‰¹å¾çš„ä¸ä¸€è‡´æ€§å°†ä¼šå½±å“æœ€åæ£€æµ‹ç»“æœï¼ˆå¤§ç›®æ ‡çš„æ£€æµ‹åœ¨æŸä¸€å±‚ï¼Œå°ç›®æ ‡çš„æ£€æµ‹åœ¨å¦ä¸€å±‚ï¼Œä½†æ˜¯ç½‘ç»œçš„å¤šå°ºå¯¸æ£€æµ‹ä¸ä¼šä»…ä»…æ£€æµ‹ä¸€ä¸ªç‰¹å®šçš„åŒºåŸŸï¼Œè€Œæ˜¯ç»¼åˆæ•´å¹…å›¾è¿›è¡Œæ£€æµ‹ã€‚åœ¨ç‰¹å¾èåˆæ—¶ï¼Œå…¶å®ƒå±‚å¾ˆå¤šæ— ç”¨çš„ä¿¡æ¯ä¹Ÿä¼šèåˆè¿›æ¥ï¼‰ã€‚</p><p>ä¸ºäº†å……åˆ†åˆ©ç”¨é«˜å±‚ç‰¹å¾çš„è¯­ä¹‰ä¿¡æ¯å’Œåº•å±‚ç‰¹å¾çš„ç»†ç²’åº¦ç‰¹å¾ï¼Œå¾ˆå¤šç½‘ç»œç»“æ„éƒ½ä¼šé‡‡ç”¨FPNçš„æ–¹å¼è¾“å‡ºå¤šå±‚ç‰¹å¾ï¼Œä½†æ˜¯æ— è®ºæ˜¯ç±»ä¼¼äºYOLOv3è¿˜æ˜¯RetinaNetä»–ä»¬å¤šç”¨concatenationæˆ–è€…element-wiseè¿™ç§ç›´æ¥è¡”æ¥æˆ–è€…ç›¸åŠ çš„æ–¹å¼ï¼Œä½œè€…è®¤ä¸ºè¿™æ ·å¹¶ä¸èƒ½å……åˆ†åˆ©ç”¨ä¸åŒå°ºåº¦çš„ç‰¹å¾ã€‚</p><p><img src="https://s2.loli.net/2023/10/12/qOCdNphDz6bH3Wf.png" alt="image.png"></p><h1 id="2-YOLOv5ä»£ç ä¿®æ”¹"><a href="#2-YOLOv5ä»£ç ä¿®æ”¹" class="headerlink" title="2.YOLOv5ä»£ç ä¿®æ”¹"></a>2.YOLOv5ä»£ç ä¿®æ”¹</h1><p>è¿™é‡Œçš„ä»£ç æˆ‘ç»“åˆyolov5çš„ç½‘ç»œç»“æ„è¿›è¡Œè¿‡ä¿®æ”¹ï¼Œæ‰€ä»¥ä¼šä¸åŸä»£ç ä¸åŒ</p><h2 id="2-1ç¬¬ä¸€æ­¥ï¼Œåœ¨models-common-pyæ–‡ä»¶æœ€ä¸‹é¢æ·»åŠ ä¸‹é¢çš„ä»£ç "><a href="#2-1ç¬¬ä¸€æ­¥ï¼Œåœ¨models-common-pyæ–‡ä»¶æœ€ä¸‹é¢æ·»åŠ ä¸‹é¢çš„ä»£ç " class="headerlink" title="2.1ç¬¬ä¸€æ­¥ï¼Œåœ¨models&#x2F;common.pyæ–‡ä»¶æœ€ä¸‹é¢æ·»åŠ ä¸‹é¢çš„ä»£ç "></a>2.1ç¬¬ä¸€æ­¥ï¼Œåœ¨models&#x2F;common.pyæ–‡ä»¶æœ€ä¸‹é¢æ·»åŠ ä¸‹é¢çš„ä»£ç </h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">def add_conv(in_ch, out_ch, ksize, stride, leaky=True):<br>    &quot;&quot;&quot;<br>    Add a conv2d / batchnorm / leaky ReLU block.<br>    Args:<br>        in_ch (int): number of input channels of the convolution layer.<br>        out_ch (int): number of output channels of the convolution layer.<br>        ksize (int): kernel size of the convolution layer.<br>        stride (int): stride of the convolution layer.<br>    Returns:<br>        stage (Sequential) : Sequential layers composing a convolution block.<br>    &quot;&quot;&quot;<br>    stage = nn.Sequential()<br>    pad = (ksize - 1) // 2<br>    stage.add_module(&#x27;conv&#x27;, nn.Conv2d(in_channels=in_ch,<br>                                       out_channels=out_ch, kernel_size=ksize, stride=stride,<br>                                       padding=pad, bias=False))<br>    stage.add_module(&#x27;batch_norm&#x27;, nn.BatchNorm2d(out_ch))<br>    if leaky:<br>        stage.add_module(&#x27;leaky&#x27;, nn.LeakyReLU(0.1))<br>    else:<br>        stage.add_module(&#x27;relu6&#x27;, nn.ReLU6(inplace=True))<br>    return stage<br> <br> <br>class ASFF(nn.Module):<br>    def __init__(self, level, rfb=False, vis=False):<br>        super(ASFF, self).__init__()<br>        self.level = level<br>        # ç‰¹å¾é‡‘å­—å¡”ä»ä¸Šåˆ°ä¸‹ä¸‰å±‚çš„channelæ•°<br>        # å¯¹åº”ç‰¹å¾å›¾å¤§å°(ä»¥640*640è¾“å…¥ä¸ºä¾‹)åˆ†åˆ«ä¸º20*20, 40*40, 80*80<br>        self.dim = [512, 256, 128]<br>        self.inter_dim = self.dim[self.level]<br>        if level==0: # ç‰¹å¾å›¾æœ€å°çš„ä¸€å±‚ï¼Œchannelæ•°512<br>            self.stride_level_1 = add_conv(256, self.inter_dim, 3, 2)<br>            self.stride_level_2 = add_conv(128, self.inter_dim, 3, 2)<br>            self.expand = add_conv(self.inter_dim, 512, 3, 1)<br>        elif level==1: # ç‰¹å¾å›¾å¤§å°é€‚ä¸­çš„ä¸€å±‚ï¼Œchannelæ•°256<br>            self.compress_level_0 = add_conv(512, self.inter_dim, 1, 1)<br>            self.stride_level_2 = add_conv(128, self.inter_dim, 3, 2)<br>            self.expand = add_conv(self.inter_dim, 256, 3, 1)<br>        elif level==2: # ç‰¹å¾å›¾æœ€å¤§çš„ä¸€å±‚ï¼Œchannelæ•°128<br>            self.compress_level_0 = add_conv(512, self.inter_dim, 1, 1)<br>            self.compress_level_1 = add_conv(256, self.inter_dim, 1, 1)<br>            self.expand = add_conv(self.inter_dim, 128, 3, 1)<br> <br>        compress_c = 8 if rfb else 16  #when adding rfb, we use half number of channels to save memory<br> <br>        self.weight_level_0 = add_conv(self.inter_dim, compress_c, 1, 1)<br>        self.weight_level_1 = add_conv(self.inter_dim, compress_c, 1, 1)<br>        self.weight_level_2 = add_conv(self.inter_dim, compress_c, 1, 1)<br> <br>        self.weight_levels = nn.Conv2d(compress_c*3, 3, kernel_size=1, stride=1, padding=0)<br>        self.vis= vis<br> <br> <br>    def forward(self, x_level_0, x_level_1, x_level_2):<br>        if self.level==0:<br>            level_0_resized = x_level_0<br>            level_1_resized = self.stride_level_1(x_level_1)<br> <br>            level_2_downsampled_inter =F.max_pool2d(x_level_2, 3, stride=2, padding=1)<br>            level_2_resized = self.stride_level_2(level_2_downsampled_inter)<br> <br>        elif self.level==1:<br>            level_0_compressed = self.compress_level_0(x_level_0)<br>            level_0_resized =F.interpolate(level_0_compressed, scale_factor=2, mode=&#x27;nearest&#x27;)<br>            level_1_resized =x_level_1<br>            level_2_resized =self.stride_level_2(x_level_2)<br>        elif self.level==2:<br>            level_0_compressed = self.compress_level_0(x_level_0)<br>            level_0_resized =F.interpolate(level_0_compressed, scale_factor=4, mode=&#x27;nearest&#x27;)<br>            level_1_compressed = self.compress_level_1(x_level_1)<br>            level_1_resized =F.interpolate(level_1_compressed, scale_factor=2, mode=&#x27;nearest&#x27;)<br>            level_2_resized =x_level_2<br> <br>        level_0_weight_v = self.weight_level_0(level_0_resized)<br>        level_1_weight_v = self.weight_level_1(level_1_resized)<br>        level_2_weight_v = self.weight_level_2(level_2_resized)<br>        levels_weight_v = torch.cat((level_0_weight_v, level_1_weight_v, level_2_weight_v),1)<br>        levels_weight = self.weight_levels(levels_weight_v)<br>        levels_weight = F.softmax(levels_weight, dim=1)<br> <br>        fused_out_reduced = level_0_resized * levels_weight[:,0:1,:,:]+\<br>                            level_1_resized * levels_weight[:,1:2,:,:]+\<br>                            level_2_resized * levels_weight[:,2:,:,:]<br> <br>        out = self.expand(fused_out_reduced)<br> <br>        if self.vis:<br>            return out, levels_weight, fused_out_reduced.sum(dim=1)<br>        else:<br>            return out<br></code></pre></td></tr></table></figure><h2 id="2-2-ç¬¬äºŒæ­¥ï¼Œåœ¨models-yolo-pyæ–‡ä»¶çš„Detectç±»ä¸‹é¢æ·»åŠ ä¸‹é¢çš„ç±»-æˆ‘çš„æ˜¯åœ¨92è¡ŒåŠ çš„"><a href="#2-2-ç¬¬äºŒæ­¥ï¼Œåœ¨models-yolo-pyæ–‡ä»¶çš„Detectç±»ä¸‹é¢æ·»åŠ ä¸‹é¢çš„ç±»-æˆ‘çš„æ˜¯åœ¨92è¡ŒåŠ çš„" class="headerlink" title="2.2 ç¬¬äºŒæ­¥ï¼Œåœ¨models&#x2F;yolo.pyæ–‡ä»¶çš„Detectç±»ä¸‹é¢æ·»åŠ ä¸‹é¢çš„ç±»(æˆ‘çš„æ˜¯åœ¨92è¡ŒåŠ çš„)"></a>2.2 ç¬¬äºŒæ­¥ï¼Œåœ¨models&#x2F;yolo.pyæ–‡ä»¶çš„Detectç±»ä¸‹é¢æ·»åŠ ä¸‹é¢çš„ç±»(æˆ‘çš„æ˜¯åœ¨92è¡ŒåŠ çš„)</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">class ASFF_Detect(Detect):<br>    # ASFF model for improvement<br>    def __init__(self, nc=80, anchors=(), ch=(), inplace=True):  # detection layer<br>        super().__init__(nc, anchors, ch, inplace)<br>        self.nl = len(anchors)<br>        self.asffs = nn.ModuleList(ASFF(i) for i in range(self.nl))<br>        self.detect = Detect.forward<br> <br>    def forward(self, x): # xä¸­çš„ç‰¹å¾å›¾ä»å¤§åˆ°å°ï¼Œä¸ASFFä¸­é¡ºåºç›¸åï¼Œå› æ­¤è¾“å…¥å‰å…ˆåå‘<br>        x = x[::-1]<br>        for i in range(self.nl):<br>            x[i] = self.asffs[i](*x)<br>        return self.detect(self, x[::-1])<br></code></pre></td></tr></table></figure><h2 id="2-3-ç¬¬ä¸‰æ­¥ï¼Œåœ¨æœ‰yolo-pyè¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œå‡ºç°-Detect-Segmentè¿™ä¸ªä»£ç ç‰‡æ®µçš„åœ°æ–¹åŠ å…¥ASFF-Detect"><a href="#2-3-ç¬¬ä¸‰æ­¥ï¼Œåœ¨æœ‰yolo-pyè¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œå‡ºç°-Detect-Segmentè¿™ä¸ªä»£ç ç‰‡æ®µçš„åœ°æ–¹åŠ å…¥ASFF-Detect" class="headerlink" title="2.3 ç¬¬ä¸‰æ­¥ï¼Œåœ¨æœ‰yolo.pyè¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œå‡ºç° Detect, Segmentè¿™ä¸ªä»£ç ç‰‡æ®µçš„åœ°æ–¹åŠ å…¥ASFF_Detect"></a>2.3 ç¬¬ä¸‰æ­¥ï¼Œåœ¨æœ‰yolo.pyè¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œå‡ºç° Detect, Segmentè¿™ä¸ªä»£ç ç‰‡æ®µçš„åœ°æ–¹åŠ å…¥ASFF_Detect</h2><p>åœ¨yolo.pyæ–‡ä»¶ä¸­çš„class BaseModel(nn.Module):å…¶ä¸­éƒ¨åˆ†ä»£ç ä¿®æ”¹å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">def _apply(self, fn):<br>    # Apply to(), cpu(), cuda(), half() to model tensors that are not parameters or registered buffers<br>    self = super()._apply(fn)<br>    m = self.model[-1]  # Detect()<br>    if isinstance(m, (Detect, Segment, ASFF_Detect)):#æ·»åŠ ASFF_Detect<br>        m.stride = fn(m.stride)<br>        m.grid = list(map(fn, m.grid))<br>        if isinstance(m.anchor_grid, list):<br>            m.anchor_grid = list(map(fn, m.anchor_grid))<br>    return self<br></code></pre></td></tr></table></figure><p>ä¸‹é¢è¿™éƒ¨åˆ†ä»£ç ä¸éœ€è¦ä¿®æ”¹ï¼Œå› ä¸ºä¸€èˆ¬ä¼šåœ¨yolov5s.yamlä¸­çš„æ¨¡å‹ä¸­æœ€åä¸€å±‚ä¿®æ”¹ä¸ºASFF_Detectï¼Œä½†æ˜¯æœ‰çš„ç‰ˆæœ¬è¿™éƒ¨åˆ†ä»£ç ä¸ä¸€æ ·ï¼Œå¦‚æœæ˜¯ç±»ä¼¼äºif isinstance(m, (Detect, Segment)):è¿™æ ·çš„ä»£ç ï¼Œä¾ç„¶éœ€è¦åœ¨åé¢æ·»åŠ ASFF_Detect</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">def _profile_one_layer(self, m, x, dt):<br>    c = m == self.model[-1]  # is final layer, copy input as inplace fix<br></code></pre></td></tr></table></figure><p>class DetectionModel(BaseModel):ç±»å…¶ä¸­éƒ¨åˆ†ä»£ç ä¿®æ”¹å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plaintext"># Build strides, anchors<br>m = self.model[-1]  # Detect()<br>if isinstance(m, (Detect, Segment, ASFF_Detect)):#æ·»åŠ ASFF_Detect<br>    s = 256  # 2x min stride<br></code></pre></td></tr></table></figure><p>åœ¨yolo.pyæ–‡ä»¶parse_modelå‡½æ•°ä¸‹åšå¦‚ä¸‹ä¿®æ”¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plaintext"># TODO: channel, gw, gd<br>elif m in &#123;Detect, Segment, ASFF_Detect&#125;:#æ·»åŠ ASFF_Detect<br>    args.append([ch[x] for x in f])<br><br></code></pre></td></tr></table></figure><h2 id="2-4-ç¬¬å››æ­¥ï¼Œä¿®æ”¹yolov5s-asff-yaml"><a href="#2-4-ç¬¬å››æ­¥ï¼Œä¿®æ”¹yolov5s-asff-yaml" class="headerlink" title="2.4 ç¬¬å››æ­¥ï¼Œä¿®æ”¹yolov5s_asff.yaml"></a>2.4 ç¬¬å››æ­¥ï¼Œä¿®æ”¹yolov5s_asff.yaml</h2><p>åœ¨æœ€åä¸€å±‚å°†Detectä¿®æ”¹ä¸ºASFF_Detect</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs plaintext"># YOLOv5 ğŸš€ by Ultralytics, GPL-3.0 license<br> <br># Parameters<br>nc: 2  # number of classes<br>depth_multiple: 0.33  # model depth multiple<br>width_multiple: 0.50  # layer channel multiple<br>anchors:<br>  - [10,13, 16,30, 33,23]  # P3/8<br>  - [30,61, 62,45, 59,119]  # P4/16<br>  - [116,90, 156,198, 373,326]  # P5/32<br> <br># YOLOv5 v6.0 backbone<br>backbone:<br>  # [from, number, module, args]<br>  [[-1, 1, Conv, [64, 6, 2, 2]],  # 0-P1/2<br>   [-1, 1, Conv, [128, 3, 2]],  # 1-P2/4<br>   [-1, 3, C3, [128]],<br>   [-1, 1, Conv, [256, 3, 2]],  # 3-P3/8<br>   [-1, 6, C3, [256]],<br>   [-1, 1, Conv, [512, 3, 2]],  # 5-P4/16<br>   [-1, 9, C3, [512]],<br>   [-1, 1, Conv, [1024, 3, 2]],  # 7-P5/32<br>   [-1, 3, C3, [1024]],<br>   [-1, 1, SPPF, [1024, 5]],  # 9<br>  ]<br> <br># YOLOv5 v6.0 head<br>head:<br>  [[-1, 1, Conv, [512, 1, 1]],<br>   [-1, 1, nn.Upsample, [None, 2, &#x27;nearest&#x27;]],<br>   [[-1, 6], 1, Concat, [1]],  # cat backbone P4<br>   [-1, 3, C3, [512, False]],  # 13<br> <br>   [-1, 1, Conv, [256, 1, 1]],<br>   [-1, 1, nn.Upsample, [None, 2, &#x27;nearest&#x27;]],<br>   [[-1, 4], 1, Concat, [1]],  # cat backbone P3<br>   [-1, 3, C3, [256, False]],  # 17 (P3/8-small)<br> <br>   [-1, 1, Conv, [256, 3, 2]],<br>   [[-1, 14], 1, Concat, [1]],  # cat head P4<br>   [-1, 3, C3, [512, False]],  # 20 (P4/16-medium)<br> <br>   [-1, 1, Conv, [512, 3, 2]],<br>   [[-1, 10], 1, Concat, [1]],  # cat head P5<br>   [-1, 3, C3, [1024, False]],  # 23 (P5/32-large)<br> <br>   [[17, 20, 23], 1, ASFF_Detect, [nc, anchors]],  # Detect(P3, P4, P5)<br>  ]<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/myblog/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/myblog/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="-yolov5 -ASFF -detect" scheme="https://qzpzd.github.io/myblog/tags/yolov5-ASFF-detect/"/>
    
  </entry>
  
  <entry>
    <title>(å››)yolov5ä¿®æ”¹æŸå¤±å‡½æ•°æƒé‡ç³»æ•°|æå‡å°ç›®æ ‡æ£€æµ‹</title>
    <link href="https://qzpzd.github.io/myblog/2023/10/12/yolov5_loss/"/>
    <id>https://qzpzd.github.io/myblog/2023/10/12/yolov5_loss/</id>
    <published>2023-10-12T06:51:35.000Z</published>
    <updated>2023-10-12T09:53:48.064Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/myblog/css/APlayer.min.css"><script src="/myblog/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/myblog/js/Meting.min.js"></script><h1 id="æŸå¤±è®¡ç®—"><a href="#æŸå¤±è®¡ç®—" class="headerlink" title="æŸå¤±è®¡ç®—"></a>æŸå¤±è®¡ç®—</h1><p>YOLOv5çš„æŸå¤±ä¸»è¦ç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼š</p><p>Classes lossï¼Œåˆ†ç±»æŸå¤±ï¼Œé‡‡ç”¨çš„æ˜¯BCE lossï¼Œæ³¨æ„åªè®¡ç®—æ­£æ ·æœ¬çš„åˆ†ç±»æŸå¤±ã€‚Â </p><p>Objectness lossï¼ŒobjæŸå¤±ï¼Œé‡‡ç”¨çš„ä¾ç„¶æ˜¯BCE lossï¼Œæ³¨æ„è¿™é‡Œçš„objæŒ‡çš„æ˜¯ç½‘ç»œé¢„æµ‹çš„ç›®æ ‡è¾¹ç•Œæ¡†ä¸GT Boxçš„CIoUã€‚è¿™é‡Œè®¡ç®—çš„æ˜¯æ‰€æœ‰æ ·æœ¬çš„objæŸå¤±ã€‚Â </p><p>Location lossï¼Œå®šä½æŸå¤±ï¼Œé‡‡ç”¨çš„æ˜¯CIoU lossï¼Œæ³¨æ„åªè®¡ç®—æ­£æ ·æœ¬çš„å®šä½æŸå¤±ã€‚<br><img src="https://s2.loli.net/2023/10/12/my9WaDVM81bsNCF.png" alt="image.png"></p><p>åœ¨æºç ä¸­ï¼Œé’ˆå¯¹é¢„æµ‹å°ç›®æ ‡çš„é¢„æµ‹ç‰¹å¾å±‚ï¼ˆP3ï¼‰é‡‡ç”¨çš„æƒé‡æ˜¯4.0ï¼Œé’ˆå¯¹é¢„æµ‹ä¸­ç­‰ç›®æ ‡çš„é¢„æµ‹ç‰¹å¾å±‚ï¼ˆP4ï¼‰é‡‡ç”¨çš„æƒé‡æ˜¯1.0ï¼Œé’ˆå¯¹é¢„æµ‹å¤§ç›®æ ‡çš„é¢„æµ‹ç‰¹å¾å±‚ï¼ˆP5ï¼‰é‡‡ç”¨çš„æƒé‡æ˜¯0.4ï¼Œä½œè€…è¯´è¿™æ˜¯é’ˆå¯¹COCOæ•°æ®é›†è®¾ç½®çš„è¶…å‚æ•°ã€‚</p><p><img src="https://s2.loli.net/2023/10/12/1q4WwCNskn8SEVl.png" alt="image.png"></p><p>å¯¹åº”åœ¨loss.pyæ–‡ä»¶ä¸­çš„class ComputeLossç±»æ‰¾åˆ°ä¸‹é¢ä»£ç ï¼Œä¿®æ”¹ç›¸åº”çš„æ•°å€¼</p><figure class="highlight plaintext"><figcaption><span>[loss]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">self.balance = &#123;3: [4.0, 1.0, 0.4]&#125;.get(m.nl, [4.0, 1.0, 0.25, 0.06, 0.02])  # P3-P7<br></code></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/myblog/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/myblog/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="-yolov5 -loss" scheme="https://qzpzd.github.io/myblog/tags/yolov5-loss/"/>
    
  </entry>
  
  <entry>
    <title>(ä¸‰)yolov5æ£€æµ‹å¤´headé­”æ”¹ä¹‹CBAMï¼ŒODConv|æ·»åŠ æ³¨æ„åŠ›</title>
    <link href="https://qzpzd.github.io/myblog/2023/10/12/yolov5_head_CBAM/"/>
    <id>https://qzpzd.github.io/myblog/2023/10/12/yolov5_head_CBAM/</id>
    <published>2023-10-12T06:51:35.000Z</published>
    <updated>2023-10-12T09:28:00.052Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/myblog/css/APlayer.min.css"><script src="/myblog/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/myblog/js/Meting.min.js"></script><h1 id="1-CBAMä»‹ç»"><a href="#1-CBAMä»‹ç»" class="headerlink" title="1.CBAMä»‹ç»"></a>1.CBAMä»‹ç»</h1><p>è®ºæ–‡é¢˜ç›®ï¼šã€ŠCBAM: Convolutional Block Attention Moduleã€‹<br>è®ºæ–‡åœ°å€ï¼š  <a href="https://arxiv.org/pdf/1807.06521.pdf">https://arxiv.org/pdf/1807.06521.pdf</a><br>å®éªŒè¯æ˜ï¼Œå°†CBAMæ³¨æ„åŠ›æ¨¡å—åµŒå…¥åˆ°YOLOv5ç½‘ç»œä¸­ï¼Œæœ‰åˆ©äºè§£å†³åŸå§‹ç½‘ç»œæ— æ³¨æ„åŠ›åå¥½çš„é—®é¢˜ã€‚ä¸»è¦åœ¨åˆ†ç±»é—®é¢˜ä¸­æ¯”è¾ƒæ˜æ˜¾</p><p><img src="https://s2.loli.net/2023/10/12/wUIdgiNVbkvB6ap.png" alt="image.png"></p><p>CBAMæ³¨æ„åŠ›ç»“æ„åŸºæœ¬åŸç†ï¼šä»ä¸Šå›¾æ˜æ˜¾å¯ä»¥çœ‹åˆ°ï¼Œ CBAMä¸€å…±åŒ…å«2ä¸ªç‹¬ç«‹çš„å­æ¨¡å—ï¼Œ é€šé“æ³¨æ„åŠ›æ¨¡å—ï¼ˆChannel Attention Moduleï¼ŒCAM) å’Œç©ºé—´æ³¨æ„åŠ›æ¨¡å—ï¼ˆSpartial Attention Moduleï¼ŒSAM) ï¼Œåˆ†åˆ«è¿›è¡Œé€šé“ä¸ç©ºé—´ç»´åº¦ä¸Šçš„æ³¨æ„åŠ›ç‰¹å¾èåˆã€‚ è¿™æ ·ä¸åªèƒ½å¤ŸèŠ‚çº¦å‚æ•°å’Œè®¡ç®—åŠ›ï¼Œå¹¶ä¸”ä¿è¯äº†å…¶èƒ½å¤Ÿåšä¸ºå³æ’å³ç”¨çš„æ¨¡å—é›†æˆåˆ°ç°æœ‰çš„ç½‘ç»œæ¶æ„ä¸­å»ã€‚</p><p>é‚£å¯¹åº”YOLOv5ç»“åˆCBAMéœ€è¦ä¿®æ”¹å“ªäº›åœ°æ–¹ï¼š</p><h1 id="2-common-pyä¸­åŠ å…¥CBAMä»£ç "><a href="#2-common-pyä¸­åŠ å…¥CBAMä»£ç " class="headerlink" title="2.common.pyä¸­åŠ å…¥CBAMä»£ç "></a>2.common.pyä¸­åŠ å…¥CBAMä»£ç </h1><figure class="highlight plaintext"><figcaption><span>[CBAM]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">class ChannelAttentionModule(nn.Module):<br>    def __init__(self, c1, reduction=16):<br>        super(ChannelAttentionModule, self).__init__()<br>        mid_channel = c1 // reduction<br>        self.avg_pool = nn.AdaptiveAvgPool2d(1)<br>        self.max_pool = nn.AdaptiveMaxPool2d(1)<br>        self.shared_MLP = nn.Sequential(<br>            nn.Linear(in_features=c1, out_features=mid_channel),<br>            nn.ReLU(),<br>            nn.Linear(in_features=mid_channel, out_features=c1)<br>        )<br>        self.sigmoid = nn.Sigmoid()<br>        #self.act=SiLU()<br>    def forward(self, x):<br>        avgout = self.shared_MLP(self.avg_pool(x).view(x.size(0),-1)).unsqueeze(2).unsqueeze(3)<br>        maxout = self.shared_MLP(self.max_pool(x).view(x.size(0),-1)).unsqueeze(2).unsqueeze(3)<br>        return self.sigmoid(avgout + maxout)<br>class SpatialAttentionModule(nn.Module):<br>    def __init__(self):<br>        super(SpatialAttentionModule, self).__init__()<br>        self.conv2d = nn.Conv2d(in_channels=2, out_channels=1, kernel_size=7, stride=1, padding=3) <br>        #self.act=SiLU()<br>        self.sigmoid = nn.Sigmoid()<br>    def forward(self, x):<br>        avgout = torch.mean(x, dim=1, keepdim=True)<br>        maxout, _ = torch.max(x, dim=1, keepdim=True)<br>        out = torch.cat([avgout, maxout], dim=1)<br>        out = self.sigmoid(self.conv2d(out))<br>        return out<br> <br>class CBAM(nn.Module):<br>    def __init__(self, c1,c2):<br>        super(CBAM, self).__init__()<br>        self.channel_attention = ChannelAttentionModule(c1)<br>        self.spatial_attention = SpatialAttentionModule()<br> <br>    def forward(self, x):<br>        out = self.channel_attention(x) * x<br>        out = self.spatial_attention(out) * out<br>        return out<br></code></pre></td></tr></table></figure><h1 id="3-åœ¨yolo-pyæ–‡ä»¶ä¸­æ·»åŠ å¯¹åº”çš„CBAM"><a href="#3-åœ¨yolo-pyæ–‡ä»¶ä¸­æ·»åŠ å¯¹åº”çš„CBAM" class="headerlink" title="3.åœ¨yolo.pyæ–‡ä»¶ä¸­æ·»åŠ å¯¹åº”çš„CBAM"></a>3.åœ¨yolo.pyæ–‡ä»¶ä¸­æ·»åŠ å¯¹åº”çš„CBAM</h1><figure class="highlight plaintext"><figcaption><span>[yolo.py]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext"> if m in [Conv, GhostConv, Bottleneck, GhostBottleneck, SPP, <br>DWConv, MixConv2d, Focus, CrossConv, BottleneckCSP, C3, C3TR, CBAM]:      <br></code></pre></td></tr></table></figure><h1 id="4-åœ¨yolov5s-yamlæ–‡ä»¶ä¸­æ·»åŠ CBAM"><a href="#4-åœ¨yolov5s-yamlæ–‡ä»¶ä¸­æ·»åŠ CBAM" class="headerlink" title="4.åœ¨yolov5s.yamlæ–‡ä»¶ä¸­æ·»åŠ CBAM"></a>4.åœ¨yolov5s.yamlæ–‡ä»¶ä¸­æ·»åŠ CBAM</h1><p>æ ¹æ®å®é™…è®­ç»ƒæ•ˆæœï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­çš„C3æ¨¡å—åé¢é€‚å½“æ·»åŠ CBAMæ³¨æ„åŠ›æ¨¡å—ï¼Œè¿‡ç¨‹ä¸­æ³¨æ„é€šé“æ•°å’Œç½‘ç»œå±‚æ•°çš„å˜åŒ–ï¼ˆæ³¨ï¼šä¸åŒæ·»åŠ ä½ç½®æ•ˆæœå¯èƒ½ä¸å¤§ä¸€æ ·ï¼‰ï¼Œä¾‹å¦‚ä¸‹é¢ä½œä¸ºå‚è€ƒï¼šåœ¨æœ€åæ£€æµ‹å±‚ä¸Šé¢æ·»åŠ CBAMï¼Œå…¶ä¸­BiFPNDï¼ŒBiFPNTåˆ†åˆ«æ˜¯äºŒåˆ†æ”¯ä¸ä¸‰åˆ†æ”¯çš„BiFPN</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">#Head<br>head:<br>  [[-1, 1, Conv, [512, 1, 1]],                     #14<br>   [-1, 1, nn.Upsample, [None, 2, &#x27;nearest&#x27;]],     #15<br>   [[-1, 9], 1, BiFPND, [256, 256]],               #16 <br>   [-1, 3, C3, [512, False]],                      #17<br> <br>   [-1, 1, Conv, [256, 1, 1]],                     #18<br>   [-1, 1, nn.Upsample, [None, 2, &#x27;nearest&#x27;]],     #19<br>   [[-1, 6], 1, BiFPND, [128, 128]],               #20 <br>   [-1, 3, C3, [256, False]],                      #21 <br> <br>   [-1, 1, Conv, [512, 3, 2]],                     #22<br>   [[-1, 17, 9], 1, BiFPNT, [256, 256]],          #23<br>   [-1, 3, C3, [512, False]],                      #24 <br> <br>   [-1, 1, Conv, [512, 3, 2]],                     #25<br>   [[-1, 14], 1, BiFPND, [256, 256]],              #26<br>   [-1, 3, C3, [1024, False]],                     #27 <br>   [-1, 1, CBAM, [1024]],                            #28<br> <br>   [[21, 24, 28], 1, Detect, [nc, anchors]],       #29 Detect<br>  ]<br></code></pre></td></tr></table></figure><h1 id="å…¶å®ƒæ³¨æ„åŠ›SEï¼ŒECAä¸CSBAMåŒºåˆ«"><a href="#å…¶å®ƒæ³¨æ„åŠ›SEï¼ŒECAä¸CSBAMåŒºåˆ«" class="headerlink" title="å…¶å®ƒæ³¨æ„åŠ›SEï¼ŒECAä¸CSBAMåŒºåˆ«"></a>å…¶å®ƒæ³¨æ„åŠ›SEï¼ŒECAä¸CSBAMåŒºåˆ«</h1><p>æ³¨æ„åŠ›æœºåˆ¶é¡¾åæ€ä¹‰å°±æ˜¯é€šè¿‡å¯¹æ„Ÿå…´è¶£çš„åŒºåŸŸæå‡æ›´å¤šçš„æ³¨æ„åŠ›ï¼Œå°½å¯èƒ½çš„æŠ‘åˆ¶ä¸æ„Ÿå…´è¶£çš„åŒºåŸŸåœ¨å›¾åƒåˆ†å‰²ä¸­çš„ä½œç”¨ã€‚æ·±åº¦å­¦ä¹ CNNä¸­å¯ä»¥å°†æ³¨æ„åŠ›æœºåˆ¶åˆ†ä¸ºé€šé“æ³¨æ„åŠ›å’Œç©ºé—´æ³¨æ„åŠ›ä¸¤ç§ï¼Œé€šé“æ³¨æ„åŠ›æ˜¯ç¡®å®šä¸åŒé€šé“ä¹‹é—´çš„æƒé‡å…³ç³»ï¼Œæå‡é‡ç‚¹é€šé“çš„æƒé‡ï¼ŒæŠ‘åˆ¶ä½œç”¨ä¸å¤§çš„é€šé“ï¼Œç©ºé—´æ³¨æ„åŠ›æ˜¯ç¡®å®šç©ºé—´é‚»åŸŸä¸åŒåƒç´ ä¹‹é—´çš„æƒé‡å…³ç³»ï¼Œæå‡é‡ç‚¹åŒºåŸŸåƒç´ çš„æƒé‡ï¼Œè®©ç®—æ³•æ›´å¤šçš„å…³æ³¨æˆ‘ä»¬éœ€è¦çš„ç ”ç©¶åŒºåŸŸï¼Œå‡å°éå¿…è¦åŒºåŸŸçš„æƒé‡ã€‚</p><p><strong>ä¸€ã€SE (Squeeze and Excitationï¼‰æ³¨æ„åŠ›æœºåˆ¶</strong><br>SEæ³¨æ„åŠ›æœºåˆ¶æ˜¯é€šé“æ³¨æ„åŠ›æ¨¡å¼ä¸‹çš„ä¸€ç§ç¡®å®šæƒé‡çš„æ–¹æ³•ï¼Œå®ƒé€šè¿‡åœ¨ä¸åŒé€šé“é—´åˆ†é…æƒé‡è¾¾åˆ°ä¸»æ¬¡ä¼˜å…ˆçš„ç›®çš„ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä¸ºSEæ³¨æ„åŠ›æœºåˆ¶çš„ç»“æ„å›¾ã€‚</p><p>è¯¥ç»“æ„ä¸»è¦åˆ†ä¸ºä»¥ä¸‹ä¸‰ä¸ªæ–¹é¢ï¼š</p><p>â‘ ï¼šé€šè¿‡å°†ç‰¹å¾å›¾è¿›è¡ŒSqueeze(å‹ç¼©)ï¼Œè¯¥æ­¥éª¤æ˜¯é€šè¿‡å…¨å±€å¹³å‡æ± åŒ–æŠŠç‰¹å¾å›¾ä»å¤§å°ä¸ºï¼ˆN,C,H,W)è½¬æ¢ä¸ºï¼ˆN,C,1,1)ï¼Œè¿™æ ·å°±è¾¾åˆ°äº†å…¨å±€ä¸Šä¸‹æ–‡ä¿¡æ¯çš„èåˆã€‚</p><p>â‘¡ï¼šExcitationæ“ä½œï¼Œè¯¥æ­¥éª¤ä½¿ç”¨ä¸¤ä¸ªå…¨è¿æ¥å±‚ï¼Œé€šè¿‡å…¨è¿æ¥å±‚ä¹‹é—´çš„éçº¿æ€§æ·»åŠ æ¨¡å‹çš„å¤æ‚åº¦ï¼Œè¾¾åˆ°ç¡®å®šä¸åŒé€šé“ä¹‹é—´çš„æƒé‡ä½œç”¨ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå…¨è¿æ¥å±‚ä½¿ç”¨ReLUæ¿€æ´»å‡½æ•°ï¼Œç¬¬äºŒä¸ªå…¨è¿æ¥å±‚é‡‡ç”¨Sigmoidæ¿€æ´»å‡½æ•°ï¼Œä¸ºäº†å°†æƒé‡ä¸­æ˜ å°„åˆ°ï¼ˆ0ï¼Œ1ï¼‰ä¹‹é—´ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¸ºäº†å‡å°‘è®¡ç®—é‡è¿›è¡Œé™ç»´å¤„ç†ï¼Œå°†ç¬¬ä¸€ä¸ªå…¨è¿æ¥çš„è¾“å‡ºé‡‡ç”¨è¾“å…¥çš„1&#x2F;4æˆ–è€…1&#x2F;16ã€‚</p><p>â‘¢ï¼šå°†reshapeè¿‡åçš„æƒé‡å€¼ä¸åŸæœ‰çš„ç‰¹å¾å›¾åšä¹˜æ³•è¿ç®—ï¼ˆè¯¥æ­¥éª¤é‡‡ç”¨äº†Pythonçš„å¹¿æ’­æœºåˆ¶ï¼‰ï¼Œå¾—åˆ°ä¸åŒæƒé‡ä¸‹çš„ç‰¹å¾å›¾ã€‚</p><p><img src="https://s2.loli.net/2023/10/12/IPld8LETkFc6B5w.png" alt="image.png"></p><p>å…·ä½“PyTorchå®ç°ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">import torch<br>import torch.nn as nn<br><br><br>class Se(nn.Module):<br>    def __init__(self,in_channel,reduction=16):<br>        super(Se, self).__init__()<br>        self.pool=nn.AdaptiveAvgPool2d(output_size=1)<br>        self.fc=nn.Sequential(<br>            nn.Linear(in_features=in_channel,out_features=in_channel//reduction,bias=False),<br>            nn.ReLU(),<br>            nn.Linear(in_features=in_channel//reduction,out_features=in_channel,bias=False),<br>            nn.Sigmoid()<br>        )<br><br>    def forward(self,x):<br>        out=self.pool(x)<br>        out=self.fc(out.view(out.size(0),-1))<br>        out=out.view(x.size(0),x.size(1),1,1)<br>        return out*x<br></code></pre></td></tr></table></figure><p><strong>äºŒã€ECAï¼ˆEfficient Channel Attentionï¼‰</strong><br>ECAæ³¨æ„åŠ›æœºåˆ¶ä¹Ÿæ˜¯é€šé“æ³¨æ„åŠ›çš„ä¸€ç§æ–¹æ³•ï¼Œè¯¥ç®—æ³•æ˜¯åœ¨SEç®—æ³•çš„åŸºç¡€ä¸Šåšå‡ºäº†ä¸€å®šçš„æ”¹è¿›ï¼Œé¦–å…ˆECAä½œè€…è®¤ä¸ºSEè™½ç„¶å…¨è¿æ¥çš„é™ç»´å¯ä»¥é™ä½æ¨¡å‹çš„å¤æ‚åº¦ï¼Œä½†æ˜¯ç ´åäº†é€šé“ä¸å…¶æƒé‡ä¹‹é—´çš„ç›´æ¥å¯¹åº”å…³ç³»ï¼Œå…ˆé™ç»´åå‡ç»´ï¼Œè¿™æ ·æƒé‡å’Œé€šé“çš„å¯¹åº”å…³ç³»æ˜¯é—´æ¥çš„ï¼ŒåŸºäºä¸Šè¿°ï¼Œä½œè€…æå‡ºä¸€ç»´å·ç§¯çš„æ–¹æ³•ï¼Œé¿å…äº†é™ç»´å¯¹æ•°æ®çš„å½±å“ã€‚</p><p>è¯¥ç»“æ„ä¸»è¦åˆ†ä¸ºä»¥ä¸‹ä¸‰ä¸ªæ–¹é¢ï¼š</p><p>â‘ ï¼šé€šè¿‡å°†ç‰¹å¾å›¾è¿›è¡ŒSqueeze(å‹ç¼©)ï¼Œè¯¥æ­¥éª¤æ˜¯é€šè¿‡å…¨å±€å¹³å‡æ± åŒ–æŠŠç‰¹å¾å›¾ä»å¤§å°ä¸ºï¼ˆN,C,H,W)è½¬æ¢ä¸ºï¼ˆN,C,1,1)ï¼Œè¿™æ ·å°±è¾¾åˆ°äº†å…¨å±€ä¸Šä¸‹æ–‡ä¿¡æ¯çš„èåˆï¼Œè¯¥æ­¥éª¤å’ŒSEä¸€æ ·ã€‚</p><p>â‘¡ï¼šè®¡ç®—è‡ªé€‚åº”å·ç§¯æ ¸çš„å¤§å°ï¼Œ<br> ï¼Œå…¶ä¸­Cä¸ºè¾“å…¥çš„é€šé“æ•°ï¼Œb&#x3D;1ï¼Œ<br> &#x3D;2ï¼Œå¹¶é‡‡ç”¨ä¸€ç»´å·ç§¯è®¡ç®—é€šé“çš„æƒé‡ï¼Œæœ€åé‡‡ç”¨Sigmoidæ¿€æ´»å‡½æ•°å°†æƒé‡æ˜ å°„åœ¨ï¼ˆ0-1ï¼‰ä¹‹é—´ã€‚</p><p>â‘¢ï¼šå°†reshapeè¿‡åçš„æƒé‡å€¼ä¸åŸæœ‰çš„ç‰¹å¾å›¾åšä¹˜æ³•è¿ç®—ï¼ˆè¯¥æ­¥éª¤é‡‡ç”¨äº†Pythonçš„å¹¿æ’­æœºåˆ¶ï¼‰ï¼Œå¾—åˆ°ä¸åŒæƒé‡ä¸‹çš„ç‰¹å¾å›¾ã€‚</p><p><img src="https://s2.loli.net/2023/10/12/NhXnP3lx5a7FTvG.png" alt="image.png"></p><p>å…·ä½“PyTorchå®ç°ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">import torch<br>import torch.nn as nn<br>import math<br>class ECA(nn.Module):<br>    def __init__(self,in_channel,gamma=2,b=1):<br>        super(ECA, self).__init__()<br>        k=int(abs((math.log(in_channel,2)+b)/gamma))<br>        kernel_size=k if k % 2 else k+1<br>        padding=kernel_size//2<br>        self.pool=nn.AdaptiveAvgPool2d(output_size=1)<br>        self.conv=nn.Sequential(<br>            nn.Conv1d(in_channels=1,out_channels=1,kernel_size=kernel_size,padding=padding,bias=False),<br>            nn.Sigmoid()<br>        )<br><br>    def forward(self,x):<br>        out=self.pool(x)<br>        out=out.view(x.size(0),1,x.size(1))<br>        out=self.conv(out)<br>        out=out.view(x.size(0),x.size(1),1,1)<br>        return out*x<br></code></pre></td></tr></table></figure><p><strong>ä¸‰ã€CBAMï¼ˆConvolutional Block Attention Moduleï¼‰</strong><br>CBAMæ³¨æ„åŠ›æœºåˆ¶æ˜¯ä¸€ç§å°†é€šé“ä¸ç©ºé—´æ³¨æ„åŠ›æœºåˆ¶ç›¸ç»“åˆçš„ç®—æ³•æ¨¡å‹ï¼Œç®—æ³•æ•´ä½“ç»“æ„å¦‚å›¾3æ‰€ç¤ºï¼Œè¾“å…¥ç‰¹å¾å›¾å…ˆè¿›è¡Œé€šé“æ³¨æ„åŠ›æœºåˆ¶å†è¿›è¡Œç©ºé—´æ³¨æ„åŠ›æœºåˆ¶æ“ä½œï¼Œæœ€åè¾“å‡ºï¼Œè¿™æ ·ä»é€šé“å’Œç©ºé—´ä¸¤ä¸ªæ–¹é¢è¾¾åˆ°äº†å¼ºåŒ–æ„Ÿå…´è¶£åŒºåŸŸçš„ç›®çš„ã€‚</p><p>é€šé“ç»“æ„ä¸»è¦åˆ†ä¸ºä»¥ä¸‹ä¸‰ä¸ªæ–¹é¢ï¼š</p><p>â‘ ï¼šé€šè¿‡å°†ç‰¹å¾å›¾è¿›è¡ŒSqueeze(å‹ç¼©)ï¼Œè¯¥æ­¥éª¤åˆ†åˆ«é‡‡ç”¨å…¨å±€å¹³å‡æ± åŒ–å’Œå…¨å±€æœ€å¤§æ± åŒ–æŠŠç‰¹å¾å›¾ä»å¤§å°ä¸ºï¼ˆN,C,H,W)è½¬æ¢ä¸ºï¼ˆN,C,1,1)ï¼Œè¿™æ ·å°±è¾¾åˆ°äº†å…¨å±€ä¸Šä¸‹æ–‡ä¿¡æ¯çš„èåˆã€‚</p><p>â‘¡ï¼šåˆ†åˆ«å°†å…¨å±€æœ€å¤§æ± åŒ–å’Œå…¨å±€å¹³å‡æ± åŒ–ç»“æœè¿›è¡ŒMLPï¼ˆå¤šå±‚æ„ŸçŸ¥æœºï¼‰æ“ä½œï¼ŒMLPåœ¨è¿™é‡Œå®šä¹‰ä¸SEçš„æ“ä½œä¸€æ ·ï¼Œä¸ºä¸¤å±‚å…¨è¿æ¥å±‚ï¼Œä¸­é—´é‡‡ç”¨ReLUæ¿€æ´»ï¼Œæœ€åå°†ä¸¤è€…ç›¸åŠ ååˆ©ç”¨Sigmoidå‡½æ•°æ¿€æ´»ã€‚</p><p>â‘¢ï¼šå°†reshapeè¿‡åçš„æƒé‡å€¼ä¸åŸæœ‰çš„ç‰¹å¾å›¾åšä¹˜æ³•è¿ç®—ï¼ˆè¯¥æ­¥éª¤é‡‡ç”¨äº†Pythonçš„å¹¿æ’­æœºåˆ¶ï¼‰ï¼Œå¾—åˆ°ä¸åŒæƒé‡ä¸‹çš„ç‰¹å¾å›¾ã€‚</p><p>ç©ºé—´ç»“æ„ä¸»è¦åˆ†ä¸ºä»¥ä¸‹ä¸‰ä¸ªæ–¹é¢ï¼š</p><p>â‘ ï¼šå°†ä¸Šè¿°é€šé“æ³¨æ„åŠ›æ“ä½œçš„ç»“æœï¼Œåˆ†åˆ«åœ¨é€šé“ç»´åº¦ä¸Šè¿›è¡Œæœ€å¤§æ± åŒ–å’Œå¹³å‡æ± åŒ–ï¼Œå³å°†ç»è¿‡é€šé“æ³¨æ„åŠ›æœºåˆ¶çš„ç‰¹å¾å›¾ä»ï¼ˆN,C,H,W)è½¬æ¢ä¸ºï¼ˆN,1,H,Wï¼‰ï¼Œè¾¾åˆ°èåˆä¸åŒé€šé“çš„ä¿¡æ¯çš„æ•ˆæœï¼Œç„¶ååœ¨é€šé“ç»´åº¦ä¸Šå°†æœ€å¤§æ± åŒ–ä¸å¹³å‡æ± åŒ–ç»“æœå åŠ èµ·æ¥ï¼Œå³é‡‡ç”¨torch.cat()ã€‚</p><p>â‘¡ï¼šå°†å åŠ å2ä¸ªé€šé“çš„ç»“æœåšå·ç§¯è¿ç®—ï¼Œè¾“å‡ºé€šé“ä¸º1ï¼Œå·ç§¯æ ¸å¤§å°ä¸º7ï¼Œæœ€åå°†è¾“å‡ºç»“æœé‡‡ç”¨Sigmoidå‡½æ•°æ¿€æ´»ã€‚</p><p>â‘¢ï¼šå°†æƒé‡å€¼ä¸åŸæœ‰çš„ç‰¹å¾å›¾åšä¹˜æ³•è¿ç®—ï¼ˆè¯¥æ­¥éª¤é‡‡ç”¨äº†Pythonçš„å¹¿æ’­æœºåˆ¶ï¼‰ï¼Œå¾—åˆ°ä¸åŒæƒé‡ä¸‹çš„ç‰¹å¾å›¾ã€‚</p><p><img src="https://s2.loli.net/2023/10/12/wGMIACQ87LpNdhg.png" alt="image.png"></p><p>ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">import torch<br>import torch.nn as nn<br>import math<br>class CBAM(nn.Module):<br>    def __init__(self,in_channel,reduction=16,kernel_size=7):<br>        super(CBAM, self).__init__()<br>        #é€šé“æ³¨æ„åŠ›æœºåˆ¶<br>        self.max_pool=nn.AdaptiveMaxPool2d(output_size=1)<br>        self.avg_pool=nn.AdaptiveAvgPool2d(output_size=1)<br>        self.mlp=nn.Sequential(<br>            nn.Linear(in_features=in_channel,out_features=in_channel//reduction,bias=False),<br>            nn.ReLU(),<br>            nn.Linear(in_features=in_channel//reduction,out_features=in_channel,bias=False)<br>        )<br>        self.sigmoid=nn.Sigmoid()<br>        #ç©ºé—´æ³¨æ„åŠ›æœºåˆ¶<br>        self.conv=nn.Conv2d(in_channels=2,out_channels=1,kernel_size=kernel_size ,stride=1,padding=kernel_size//2,bias=False)<br><br>    def forward(self,x):<br>        #é€šé“æ³¨æ„åŠ›æœºåˆ¶<br>        maxout=self.max_pool(x)<br>        maxout=self.mlp(maxout.view(maxout.size(0),-1))<br>        avgout=self.avg_pool(x)<br>        avgout=self.mlp(avgout.view(avgout.size(0),-1))<br>        channel_out=self.sigmoid(maxout+avgout)<br>        channel_out=channel_out.view(x.size(0),x.size(1),1,1)<br>        channel_out=channel_out*x<br>        #ç©ºé—´æ³¨æ„åŠ›æœºåˆ¶<br>        max_out,_=torch.max(channel_out,dim=1,keepdim=True)<br>        mean_out=torch.mean(channel_out,dim=1,keepdim=True)<br>        out=torch.cat((max_out,mean_out),dim=1)<br>        out=self.sigmoid(self.conv(out))<br>        out=out*channel_out<br>        return out<br></code></pre></td></tr></table></figure><h1 id="å¦ä¸€åˆ©ç”¨æ³¨æ„åŠ›æ¨¡å—çš„ODConvï¼šå³æ’å³ç”¨çš„åŠ¨æ€å·ç§¯"><a href="#å¦ä¸€åˆ©ç”¨æ³¨æ„åŠ›æ¨¡å—çš„ODConvï¼šå³æ’å³ç”¨çš„åŠ¨æ€å·ç§¯" class="headerlink" title="å¦ä¸€åˆ©ç”¨æ³¨æ„åŠ›æ¨¡å—çš„ODConvï¼šå³æ’å³ç”¨çš„åŠ¨æ€å·ç§¯"></a>å¦ä¸€åˆ©ç”¨æ³¨æ„åŠ›æ¨¡å—çš„ODConvï¼šå³æ’å³ç”¨çš„åŠ¨æ€å·ç§¯</h1><p>ä¸€å®šç¨‹åº¦ä¸Šè®²ï¼ŒODConvå¯ä»¥è§†ä½œCondConvçš„å»¶ç»­ï¼Œå°†CondConvä¸­ä¸€ä¸ªç»´åº¦ä¸Šçš„åŠ¨æ€ç‰¹æ€§è¿›è¡Œäº†æ‰©å±•ï¼ŒåŒæ—¶äº†è€ƒè™‘äº†ç©ºåŸŸã€è¾“å…¥é€šé“ã€è¾“å‡ºé€šé“ç­‰ç»´åº¦ä¸Šçš„åŠ¨æ€æ€§ï¼Œæ•…ç§°ä¹‹ä¸ºå…¨ç»´åº¦åŠ¨æ€å·ç§¯ã€‚ODConvé€šè¿‡å¹¶è¡Œç­–ç•¥é‡‡ç”¨å¤šç»´æ³¨æ„åŠ›æœºåˆ¶æ²¿æ ¸ç©ºé—´çš„å››ä¸ªç»´åº¦å­¦ä¹ äº’è¡¥æ€§æ³¨æ„åŠ›ã€‚ä½œä¸ºä¸€ç§â€œå³æ’å³ç”¨â€çš„æ“ä½œï¼Œå®ƒå¯ä»¥è½»æ˜“çš„åµŒå…¥åˆ°ç°æœ‰CNNç½‘ç»œä¸­ã€‚ImageNetåˆ†ç±»ä¸COCOæ£€æµ‹ä»»åŠ¡ä¸Šçš„å®éªŒéªŒè¯äº†æ‰€æODConvçš„ä¼˜å¼‚æ€§ï¼šå³å¯æå‡å¤§æ¨¡å‹çš„æ€§èƒ½ï¼Œåˆå¯æå‡è½»é‡å‹æ¨¡å‹çš„æ€§èƒ½</p><p>åŠ¨æ€å·ç§¯è¿™å‡ å¹´ç ”ç©¶çš„éå¸¸å¤šäº†ï¼Œæ¯”è¾ƒçŸ¥åçš„æœ‰è°·æ­Œçš„CondConvï¼Œæ—·è§†ç§‘æŠ€çš„WeightNetã€MSRAçš„DynamicConvã€åä¸ºçš„DyNetã€å•†æ±¤çš„CARAFEç­‰<br>å¸¸è§„å·ç§¯åªæœ‰ä¸€ä¸ªé™æ€å·ç§¯æ ¸ä¸”ä¸è¾“å…¥æ ·æœ¬æ— å…³ã€‚å¯¹äºåŠ¨æ€å·ç§¯æ¥è¯´ï¼Œå®ƒå¯¹å¤šä¸ªå·ç§¯æ ¸è¿›è¡Œçº¿æ€§åŠ æƒï¼Œè€ŒåŠ æƒå€¼åˆ™ä¸è¾“å…¥æœ‰å…³ï¼Œè¿™å°±ä½¿å¾—åŠ¨æ€å·ç§¯å…·æœ‰è¾“å…¥ä¾èµ–æ€§ã€‚å®ƒå¯ä»¥æè¿°å¦‚ä¸‹ï¼š<br><img src="https://s2.loli.net/2023/10/12/nTFJOcZfz25ML3K.png" alt="image.png"></p><p><img src="https://s2.loli.net/2023/10/12/CgOm5r9Lqs7TY8K.png" alt="image.png"></p><p><img src="https://s2.loli.net/2023/10/12/mnjYfTA8EikboZx.png" alt="image.png"></p><p>ODConvæ¯”ä¸€èˆ¬çš„åŠ¨æ€å·ç§¯æ•ˆæœéƒ½è¦å¥½ï¼Œæ¯”ä¸€èˆ¬çš„æ³¨æ„åŠ›æœºåˆ¶æ•ˆæœä¹Ÿè¦å¥½ï¼Œå…¶å®åŠ¨æ€å·ç§¯ä¸æ³¨æ„åŠ›æœºåˆ¶æ˜¯ä»æ¨¡å—ä¸­ä¸åŒè§’åº¦è¿›è¡Œè§£æï¼ŒåŠ¨æ€å·ç§¯æ˜¯ç›¸æ¯”è¾ƒäºå¸¸è§„å·ç§¯ï¼Œæœ€ç»ˆéœ€è¦ä¸è¾“å…¥ç›¸ä¹˜ï¼Œä¸è¾“å…¥æœ‰å…³ï¼Œè€Œå¸¸è§„å·ç§¯ä¸è¾“å…¥æ— å…³ï¼›æ³¨æ„åŠ›æœºåˆ¶æ˜¯ç›¸å¯¹äºç‰¹å¾å›¾çš„å››ä¸ªç»´åº¦æ¯”è¾ƒçš„ï¼Œä¹Ÿå³å·ç§¯æ–¹å¼ä¸ä¸€æ ·ï¼Œä»¥å¾€æ˜¯ç›´æ¥è¿›è¡Œç‰¹å¾å›¾ä¸å·ç§¯æ ¸è¿›è¡Œå·ç§¯æ¥è·å–ç‰¹å¾ï¼Œè€Œæ³¨æ„åŠ›æœºåˆ¶å°±æ˜¯å°†ç‰¹å¾å›¾åˆ†åˆ«å¯¹å››ä¸ªé€šé“è¿›è¡Œå‹ç¼©ï¼Œæ¥è·å–å¯¹æ¯”æŸä¸€é€šé“åœ¨ç‰¹å¾å›¾çš„å½±å“åŠ›ï¼Œå†åˆ†åˆ«ä¸å·ç§¯æ ¸è¿›è¡Œçº¿æ€§åŠ æƒï¼Œæœ€åä¸è¾“å…¥ç›¸ä¹˜ã€‚å› æ­¤åƒåŠ¨æ€å·ç§¯ä¸æ³¨æ„åŠ›å…¶å®ä¸€ä¸ªä¸œè¥¿ï¼Œåªæ˜¯ODConvæ˜¯è€ƒè™‘åˆ°æ‰€æœ‰ç»´åº¦çš„æ³¨æ„åŠ›ï¼Œå› æ­¤æ•ˆæœæœ€å¥½</p><p>å‚è€ƒé“¾æ¥ï¼š<a href="https://zhuanlan.zhihu.com/p/468466504">https://zhuanlan.zhihu.com/p/468466504</a></p><h1 id="5-åœ¨yolov5ä¸­æ·»åŠ ODConv"><a href="#5-åœ¨yolov5ä¸­æ·»åŠ ODConv" class="headerlink" title="5.åœ¨yolov5ä¸­æ·»åŠ ODConv"></a>5.åœ¨yolov5ä¸­æ·»åŠ ODConv</h1><p><strong>1.é¦–å…ˆåœ¨common.pyæ–‡ä»¶ä¸­æ·»åŠ ä»£ç </strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br></pre></td><td class="code"><pre><code class="hljs plaintext"><br>import torch<br>import torch.nn as nn<br>import torch.nn.functional as F<br>import torch.autograd<br><br>class ODConv(nn.Sequential):<br>    def __init__(self, in_planes, out_planes, kernel_size=3, stride=1, groups=1, norm_layer=nn.BatchNorm2d,<br>                 reduction=0.0625, kernel_num=1):<br>        padding = (kernel_size - 1) // 2<br>        super(ODConv, self).__init__(<br>            ODConv2d(in_planes, out_planes, kernel_size, stride, padding, groups=groups,<br>                     reduction=reduction, kernel_num=kernel_num),<br>            norm_layer(out_planes),<br>            nn.SiLU()<br>        )<br><br>class Attention(nn.Module):<br>    def __init__(self, in_planes, out_planes, kernel_size, <br>    groups=1, <br>    reduction=0.0625, <br>    kernel_num=4, <br>    min_channel=16):<br>        super(Attention, self).__init__()<br>        attention_channel = max(int(in_planes * reduction), min_channel)<br>        self.kernel_size = kernel_size<br>        self.kernel_num = kernel_num<br>        self.temperature = 1.0<br><br>        self.avgpool = nn.AdaptiveAvgPool2d(1)<br>        self.fc = nn.Conv2d(in_planes, attention_channel, 1, bias=False)<br>        self.bn = nn.BatchNorm2d(attention_channel)<br>        self.relu = nn.ReLU(inplace=True)<br><br>        self.channel_fc = nn.Conv2d(attention_channel, in_planes, 1, bias=True)<br>        self.func_channel = self.get_channel_attention<br><br>        if in_planes == groups and in_planes == out_planes:  # depth-wise convolution<br>            self.func_filter = self.skip<br>        else:<br>            self.filter_fc = nn.Conv2d(attention_channel, out_planes, 1, bias=True)<br>            self.func_filter = self.get_filter_attention<br><br>        if kernel_size == 1:  # point-wise convolution<br>            self.func_spatial = self.skip<br>        else:<br>            self.spatial_fc = nn.Conv2d(attention_channel, kernel_size * kernel_size, 1, bias=True)<br>            self.func_spatial = self.get_spatial_attention<br><br>        if kernel_num == 1:<br>            self.func_kernel = self.skip<br>        else:<br>            self.kernel_fc = nn.Conv2d(attention_channel, kernel_num, 1, bias=True)<br>            self.func_kernel = self.get_kernel_attention<br>        self.bn_1 = nn.LayerNorm([attention_channel,1,1])<br>        self._initialize_weights()<br><br>    def _initialize_weights(self):<br>        for m in self.modules():<br>            if isinstance(m, nn.Conv2d):<br>                nn.init.kaiming_normal_(m.weight, mode=&#x27;fan_out&#x27;, nonlinearity=&#x27;relu&#x27;)<br>                if m.bias is not None:<br>                    nn.init.constant_(m.bias, 0)<br>            if isinstance(m, nn.BatchNorm2d):<br>                nn.init.constant_(m.weight, 1)<br>                nn.init.constant_(m.bias, 0)<br><br>    def update_temperature(self, temperature):<br>        self.temperature = temperature<br><br>    @staticmethod<br>    def skip(_):<br>        return 1.0<br><br>    def get_channel_attention(self, x):<br>        channel_attention = torch.sigmoid(self.channel_fc(x).view(x.size(0), -1, 1, 1) / self.temperature)<br>        return channel_attention<br><br>    def get_filter_attention(self, x):<br>        filter_attention = torch.sigmoid(self.filter_fc(x).view(x.size(0), -1, 1, 1) / self.temperature)<br>        return filter_attention<br><br>    def get_spatial_attention(self, x):<br>        spatial_attention = self.spatial_fc(x).view(x.size(0), 1, 1, 1, self.kernel_size, self.kernel_size)<br>        spatial_attention = torch.sigmoid(spatial_attention / self.temperature)<br>        return spatial_attention<br><br>    def get_kernel_attention(self, x):<br>        kernel_attention = self.kernel_fc(x).view(x.size(0), -1, 1, 1, 1, 1)<br>        kernel_attention = F.softmax(kernel_attention / self.temperature, dim=1)<br>        return kernel_attention<br><br>    def forward(self, x):<br>        x = self.avgpool(x)<br>        x = self.fc(x)<br>        x = self.bn_1(x)<br>        x = self.relu(x)<br>        return self.func_channel(x), self.func_filter(x), self.func_spatial(x), self.func_kernel(x)<br><br>class ODConv2d(nn.Module):<br>    def __init__(self, <br>    in_planes, <br>    out_planes, <br>    kernel_size=3, <br>    stride=1, <br>    padding=0, <br>    dilation=1, <br>    groups=1,<br>    reduction=0.0625, <br>    kernel_num=1):<br>        super(ODConv2d, self).__init__()<br>        self.in_planes = in_planes<br>        self.out_planes = out_planes<br>        self.kernel_size = kernel_size<br>        self.stride = stride<br>        self.padding = padding<br>        self.dilation = dilation<br>        self.groups = groups<br>        self.kernel_num = kernel_num<br>        self.attention = Attention(in_planes, out_planes, kernel_size, groups=groups,<br>                                   reduction=reduction, kernel_num=kernel_num)<br>        self.weight = nn.Parameter(torch.randn(kernel_num, out_planes, in_planes//groups, kernel_size, kernel_size),<br>                                   requires_grad=True)<br>        self._initialize_weights()<br><br>        if self.kernel_size == 1 and self.kernel_num == 1:<br>            self._forward_impl = self._forward_impl_pw1x<br>        else:<br>            self._forward_impl = self._forward_impl_common<br><br>    def _initialize_weights(self):<br>        for i in range(self.kernel_num):<br>            nn.init.kaiming_normal_(self.weight[i], mode=&#x27;fan_out&#x27;, nonlinearity=&#x27;relu&#x27;)<br><br>    def update_temperature(self, temperature):<br>        self.attention.update_temperature(temperature)<br><br>    def _forward_impl_common(self, x):<br><br>        channel_attention, filter_attention, spatial_attention, kernel_attention = self.attention(x)<br>        batch_size, in_planes, height, width = x.size()<br>        x = x * channel_attention<br>        x = x.reshape(1, -1, height, width)<br>        aggregate_weight = spatial_attention * kernel_attention * self.weight.unsqueeze(dim=0)<br>        aggregate_weight = torch.sum(aggregate_weight, dim=1).view(<br>            [-1, self.in_planes // self.groups, self.kernel_size, self.kernel_size])<br>        output = F.conv2d(x, weight=aggregate_weight, bias=None, stride=self.stride, padding=self.padding,<br>                          dilation=self.dilation, groups=self.groups * batch_size)<br>        output = output.view(batch_size, self.out_planes, output.size(-2), output.size(-1))<br>        output = output * filter_attention<br>        return output<br><br>    def _forward_impl_pw1x(self, x):<br>        channel_attention, filter_attention, spatial_attention, kernel_attention = self.attention(x)<br>        x = x * channel_attention<br>        output = F.conv2d(x, weight=self.weight.squeeze(dim=0), bias=None, stride=self.stride, padding=self.padding,<br>                          dilation=self.dilation, groups=self.groups)<br>        output = output * filter_attention<br>        return output<br><br>    def forward(self, x):<br>        return self._forward_impl(x)<br><br></code></pre></td></tr></table></figure><p><strong>2.åœ¨yolo.pyæ–‡ä»¶ä¸­æ·»åŠ å¯¹åº”çš„CBAM</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">elif m in [ODConv]:<br>    c1, c2 = ch[f], args[0]<br>    if c2 != no:  # if not output<br>        c2 = make_divisible(c2 * gw, 8)<br><br>    args = [c1, c2, *args[1:]]<br></code></pre></td></tr></table></figure><p>åœ¨yolov5.yamlæ–‡ä»¶ä¸­åˆ™éœ€è¦é™¤äº†backboneç½‘ç»œä¸­ç¬¬ä¸€ä¸ªå·ç§¯ä¹‹å¤–ï¼Œå…¶å®ƒå·ç§¯éƒ½å¯ä»¥æ›¿æ¢ä¸ºODConv<br>ä¾‹å¦‚æ›¿æ¢headä¸­ä¸€ä¸ªå·ç§¯conv</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">head:<br>  [[-1, 1, Conv, [512, 1, 1]],<br>   [-1, 1, nn.Upsample, [None, 2, &#x27;nearest&#x27;]],<br>   [[-1, 6], 1, Concat, [1]],  # cat backbone P4<br>   [-1, 3, C3, [512, False]],  # 13<br><br>   [-1, 1, Conv, [256, 1, 1]],<br>   [-1, 1, nn.Upsample, [None, 2, &#x27;nearest&#x27;]],<br>   [[-1, 4], 1, Concat, [1]],  # cat backbone P3<br>   [-1, 3, C3, [256, False]],  # 17 (P3/8-small)<br><br>   [-1, 1, Conv, [256, 3, 2]],<br>   [[-1, 14], 1, Concat, [1]],  # cat head P4<br>   [-1, 3, C3, [512, False]],  # 20 (P4/16-medium)<br><br>   [-1, 1, ODConv, [512, 3, 2]],<br>   [[-1, 10], 1, Concat, [1]],  # cat head P5<br>   [-1, 3, C3, [1024, False]],  # 23 (P5/32-large)<br><br>   [[17, 20, 23], 1, Detect, [nc, anchors]],  # Detect(P3, P4, P5)<br>  ]<br></code></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/myblog/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/myblog/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="-yolov5 -head -CBAM -ODConv" scheme="https://qzpzd.github.io/myblog/tags/yolov5-head-CBAM-ODConv/"/>
    
  </entry>
  
  <entry>
    <title>(äºŒ)yolov5æ£€æµ‹å¤´headé­”æ”¹ä¹‹BiFPN|ä¼˜åŒ–å°ç›®æ ‡æ£€æµ‹æ¶¨ç‚¹</title>
    <link href="https://qzpzd.github.io/myblog/2023/10/11/yolov5_head_BiFFPN/"/>
    <id>https://qzpzd.github.io/myblog/2023/10/11/yolov5_head_BiFFPN/</id>
    <published>2023-10-11T10:12:35.000Z</published>
    <updated>2023-10-12T03:31:24.583Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/myblog/css/APlayer.min.css"><script src="/myblog/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/myblog/js/Meting.min.js"></script><p><strong>1.YOLOv5ç®—æ³•åŸå§‹headç»“æ„</strong></p><p>YOLOv5æ¨¡å‹çš„Neckéƒ¨åˆ†ä½¿ç”¨çš„æ˜¯FPN+PANç»“æ„ï¼ŒFPNæ˜¯é’ˆå¯¹å¤šå°ºåº¦é—®é¢˜æå‡ºçš„ï¼ŒFPNç»“æ„æ˜¯è‡ªä¸Šè€Œä¸‹å¹¶ä¸”æ¨ªå‘è¿æ¥çš„ï¼Œå®ƒåˆ©ç”¨é‡‘å­—å¡”çš„å½¢å¼å¯¹å°ºåº¦ä¸åŒçš„ç‰¹å¾å›¾è¿›è¡Œè¿æ¥ï¼Œå°†é«˜å±‚ç‰¹å¾å’Œä½å±‚ç‰¹å¾è¿›è¡Œèåˆã€‚FPNä¸PANç»“åˆï¼Œå¯¹æ¥è‡ªä¸åŒéª¨å¹²å±‚çš„ä¸åŒæ£€æµ‹å±‚è¿›è¡Œå‚æ•°èšåˆã€‚è¿™ç§ç»„åˆè™½ç„¶æœ‰æ•ˆæé«˜äº†ç½‘ç»œçš„ç‰¹å¾èåˆèƒ½åŠ›ï¼Œä½†ä¹Ÿä¼šå¯¼è‡´ä¸€ä¸ªé—®é¢˜ï¼Œå³PANç»“æ„çš„è¾“å…¥å…¨éƒ¨æ˜¯FPNç»“æ„å¤„ç†çš„ç‰¹å¾ä¿¡æ¯ï¼Œè€Œéª¨å¹²ç‰¹å¾æå–ç½‘ç»œéƒ¨åˆ†çš„åŸå§‹ç‰¹å¾ä¿¡æ¯å­˜åœ¨ä¸€éƒ¨åˆ†ä¸¢å¤±ã€‚ç¼ºä¹å‚ä¸å­¦ä¹ çš„åŸå§‹ä¿¡æ¯å¾ˆå®¹æ˜“å¯¼è‡´è®­ç»ƒå­¦ä¹ çš„åå·®ï¼Œå½±å“æ£€æµ‹çš„å‡†ç¡®æ€§ã€‚</p><p>ä»neckç‰¹å¾èåˆå…¥æ‰‹ï¼Œå¼•å…¥åŠ æƒåŒå‘ç‰¹å¾é‡‘å­—å¡”BiFPNæ¥åŠ å¼ºç‰¹å¾å›¾çš„åº•å±‚ä¿¡æ¯ï¼Œä½¿ä¸åŒå°ºåº¦çš„ç‰¹å¾å›¾è¿›è¡Œä¿¡æ¯èåˆï¼Œä»è€ŒåŠ å¼ºç‰¹å¾ä¿¡æ¯ã€‚</p><p><strong>2.BiFPNåŸç†ä¸ç»“æ„</strong><br>BiFPNæ˜¯ä¸€ç§æ”¹è¿›ç‰ˆçš„FPNç½‘ç»œç»“æ„ï¼Œä¸»è¦ç”¨äºç›®æ ‡æ£€æµ‹ä»»åŠ¡ã€‚è¯¥ç»“æ„æ˜¯åŠ æƒä¸”åŒå‘è¿æ¥çš„ï¼Œå³è‡ªé¡¶å‘ä¸‹å’Œè‡ªåº•å‘ä¸Šç»“æ„ï¼Œé€šè¿‡æ„é€ åŒå‘é€šé“å®ç°è·¨å°ºåº¦è¿æ¥ï¼Œå°†ç‰¹å¾æå–ç½‘ç»œä¸­çš„ç‰¹å¾ç›´æ¥ä¸è‡ªä¸‹è€Œä¸Šè·¯å¾„ä¸­çš„ç›¸å¯¹å¤§å°ç‰¹å¾èåˆï¼Œä¿ç•™äº†æ›´æµ…çš„è¯­ä¹‰ä¿¡æ¯ï¼Œè€Œä¸ä¼šä¸¢å¤±å¤ªå¤šçš„æ·±å±‚è¯­ä¹‰ä¿¡æ¯ã€‚</p><p>ä¼ ç»Ÿçš„ç‰¹å¾èåˆæ—¶å°†å°ºåº¦ä¸åŒçš„ç‰¹å¾å›¾ä»¥ç›¸åŒæƒé‡è¿›è¡ŒåŠ æƒï¼Œä½†æ˜¯å½“è¾“å…¥çš„ç‰¹å¾å›¾åˆ†è¾¨ç‡ä¸åŒæ—¶ï¼Œä»¥ç›¸åŒçš„æƒé‡è¿›è¡ŒåŠ æƒå¯¹è¾“å‡ºçš„ç‰¹å¾å›¾ä¸å¹³ç­‰ã€‚æ‰€ä»¥BiFPNæ ¹æ®ä¸åŒè¾“å…¥ç‰¹å¾çš„é‡è¦æ€§è®¾ç½®ä¸åŒçš„æƒé‡ï¼ŒåŒæ—¶åå¤é‡‡ç”¨è¿™ç§ç»“æ„æ¥åŠ å¼ºç‰¹å¾èåˆã€‚</p><p>BiFPNç»“æ„ä¸­çš„åŠ æƒèåˆæ–¹å¼é‡‡ç”¨å¿«é€Ÿå½’ä¸€åŒ–èåˆ(Fast normalized fusion)ï¼Œè¯¥èåˆæ–¹å¼æ˜¯é’ˆå¯¹è®­ç»ƒé€Ÿåº¦æ…¢æå‡ºçš„ï¼Œå°†æƒé‡æ”¾ç¼©è‡³0~1èŒƒå›´å†…ï¼Œå› æ²¡æœ‰ä½¿ç”¨Softmaxæ–¹å¼ï¼Œæ‰€ä»¥è®­ç»ƒé€Ÿåº¦å¾ˆå¿«ã€‚è·¨å°ºåº¦è¿æ¥é€šè¿‡æ·»åŠ ä¸€ä¸ªè·³è·ƒè¿æ¥å’ŒåŒå‘è·¯å¾„æ¥å®ç°ï¼Œè‡ªæ­¤å®ç°äº†åŠ æƒèåˆå’ŒåŒå‘è·¨å°ºåº¦è¿æ¥ã€‚</p><p>ä¼ ç»Ÿçš„ç‰¹å¾èåˆå¾€å¾€åªæ˜¯ç®€å•çš„ feature map å åŠ &#x2F;ç›¸åŠ  (sum them up)ï¼Œæ¯”å¦‚ä½¿ç”¨concatæˆ–è€…shortcutè¿æ¥ï¼Œè€Œä¸å¯¹åŒæ—¶åŠ è¿›æ¥çš„ feature map è¿›è¡ŒåŒºåˆ†ã€‚ç„¶è€Œï¼Œä¸åŒçš„è¾“å…¥ feature map å…·æœ‰ä¸åŒçš„åˆ†è¾¨ç‡ï¼Œå®ƒä»¬å¯¹èåˆè¾“å…¥ feature map çš„è´¡çŒ®ä¹Ÿæ˜¯ä¸åŒçš„ï¼Œå› æ­¤ç®€å•çš„å¯¹ä»–ä»¬è¿›è¡Œç›¸åŠ æˆ–å åŠ å¤„ç†å¹¶ä¸æ˜¯æœ€ä½³çš„æ“ä½œã€‚æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬æå‡ºäº†ä¸€ç§ç®€å•è€Œé«˜æ•ˆçš„åŠ æƒç‰¹èåˆçš„æœºåˆ¶ã€‚<br>å¸¸è§çš„å¸¦æƒç‰¹å¾èåˆæœ‰ä¸‰ç§æ–¹æ³•ï¼š<br><img src="https://s2.loli.net/2023/10/11/EdCqgTs3mtwOQyL.png" alt="image.png"></p><p>BiFPNç»“æ„å¦‚å›¾æ‰€ç¤º<br><img src="https://s2.loli.net/2023/10/11/Mrgms1X9bNBwe5o.png" alt="image.png"></p><p>è¯¦ç»†ç»“æ„å›¾å¦‚ä¸‹ï¼š<br><img src="https://s2.loli.net/2023/10/11/7D2ZQEytdUqO4Ga.png" alt="image.png"><br>ä»è¿™å¼ å›¾å¯ä»¥çœ‹å‡ºå›¾ä¸­æœ‰ä¸‰ä¸ªåˆ†æ”¯ä¸ä¸¤ä¸ªåˆ†æ”¯èåˆï¼Œå¯¹åº”ä¸‹é¢çš„ä»£ç éƒ¨åˆ†</p><p>ä¸åªæœ‰ä¸€ä¸ªè‡ªé¡¶å‘ä¸‹å’Œä¸€ä¸ªè‡ªåº•å‘ä¸Šè·¯å¾„çš„PANetä¸åŒï¼Œæˆ‘ä»¬å¤„ç†æ¯ä¸ªåŒå‘è·¯å¾„(è‡ªé¡¶å‘ä¸‹å’Œè‡ªåº•è€Œä¸Š)è·¯å¾„ä½œä¸ºä¸€ä¸ªç‰¹å¾ç½‘ç»œå±‚ï¼Œå¹¶é‡å¤åŒä¸€å±‚å¤šæ¬¡ï¼Œä»¥å®ç°æ›´é«˜å±‚æ¬¡çš„ç‰¹å¾èåˆã€‚å¦‚ä¸‹å›¾EfficientNet çš„ç½‘ç»œç»“æ„æ‰€ç¤ºï¼Œæˆ‘ä»¬å¯¹BiFPNæ˜¯é‡å¤ä½¿ç”¨å¤šæ¬¡çš„ã€‚è€Œè¿™ä¸ªä½¿ç”¨æ¬¡æ•°ä¹Ÿä¸æ˜¯æˆ‘ä»¬è®¤ä¸ºè®¾å®šçš„ï¼Œè€Œæ˜¯ä½œä¸ºå‚æ•°ä¸€èµ·åŠ å…¥ç½‘ç»œçš„è®¾è®¡å½“ä¸­ï¼Œä½¿ç”¨NASæŠ€æœ¯ç®—å‡ºæ¥çš„ã€‚<br><img src="https://s2.loli.net/2023/10/11/QzS8NCevsHAVbiO.png" alt="image.png"></p><p>æ ¹æ®ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼ŒBiFPNå…¶å®å°±æ˜¯èåˆäº†FPNä¸PANå¹¶å¢åŠ äº†è·³è·ƒè¿æ¥æ¥è·å–æµ…å±‚ä¿¡æ¯ï¼Œæ‰€ä»¥å¯¹äºå°ç›®æ ‡æ£€æµ‹æ•ˆæœæ¯”è¾ƒå¥½ã€‚</p><p><strong>3.ä»£ç ä¸æ–‡ä»¶ä¿®æ”¹</strong></p><h1 id="åœ¨Common-pyä¸­æ·»åŠ å®šä¹‰æ¨¡å—-Concat"><a href="#åœ¨Common-pyä¸­æ·»åŠ å®šä¹‰æ¨¡å—-Concat" class="headerlink" title="åœ¨Common.pyä¸­æ·»åŠ å®šä¹‰æ¨¡å—(Concat)"></a>åœ¨Common.pyä¸­æ·»åŠ å®šä¹‰æ¨¡å—(Concat)</h1><figure class="highlight plaintext"><figcaption><span>[BiFPN]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs plaintext"># ç»“åˆBiFPN è®¾ç½®å¯å­¦ä¹ å‚æ•° å­¦ä¹ ä¸åŒåˆ†æ”¯çš„æƒé‡<br># ä¸¤ä¸ªåˆ†æ”¯concatæ“ä½œ<br>class BiFPN_Concat2(nn.Module):<br>    def __init__(self, dimension=1):<br>        super(BiFPN_Concat2, self).__init__()<br>        self.d = dimension<br>        self.w = nn.Parameter(torch.ones(2, dtype=torch.float32), requires_grad=True)<br>        self.epsilon = 0.0001<br>        # è®¾ç½®å¯å­¦ä¹ å‚æ•° nn.Parameterçš„ä½œç”¨æ˜¯ï¼šå°†ä¸€ä¸ªä¸å¯è®­ç»ƒçš„ç±»å‹Tensorè½¬æ¢æˆå¯ä»¥è®­ç»ƒçš„ç±»å‹ <br>        parameter<br>        # å¹¶ä¸”ä¼šå‘å®¿ä¸»æ¨¡å‹æ³¨å†Œè¯¥å‚æ•° æˆä¸ºå…¶ä¸€éƒ¨åˆ† å³model.parameters()ä¼šåŒ…å«è¿™ä¸ªparameter<br>        # ä»è€Œåœ¨å‚æ•°ä¼˜åŒ–çš„æ—¶å€™å¯ä»¥è‡ªåŠ¨ä¸€èµ·ä¼˜åŒ–<br> <br>    def forward(self, x):<br>        w = self.w<br>        weight = w / (torch.sum(w, dim=0) + self.epsilon)  # å°†æƒé‡è¿›è¡Œå½’ä¸€åŒ–<br>        # Fast normalized fusion<br>        x = [weight[0] * x[0], weight[1] * x[1]]<br>        return torch.cat(x, self.d)<br> <br> <br># ä¸‰ä¸ªåˆ†æ”¯concatæ“ä½œ<br>class BiFPN_Concat3(nn.Module):<br>    def __init__(self, dimension=1):<br>        super(BiFPN_Concat3, self).__init__()<br>        self.d = dimension<br>        self.w = nn.Parameter(torch.ones(3, dtype=torch.float32), requires_grad=True)<br>        self.epsilon = 0.0001<br> <br>    def forward(self, x):<br>        w = self.w<br>        weight = w / (torch.sum(w, dim=0) + self.epsilon)  # å°†æƒé‡è¿›è¡Œå½’ä¸€åŒ–<br>        # Fast normalized fusion<br>        x = [weight[0] * x[0], weight[1] * x[1], weight[2] * x[2]]<br>        return torch.cat(x, self.d)<br><br></code></pre></td></tr></table></figure><h1 id="ä¿®æ”¹yolov5s-yaml"><a href="#ä¿®æ”¹yolov5s-yaml" class="headerlink" title="ä¿®æ”¹yolov5s.yaml"></a>ä¿®æ”¹yolov5s.yaml</h1><p>BiFPN_Concatæœ¬è´¨æ˜¯addæ“ä½œï¼Œä¸æ˜¯concatæ“ä½œï¼Œå› æ­¤ï¼ŒBiFPN_Concatçš„å„ä¸ªè¾“å…¥å±‚è¦æ±‚å¤§å°å®Œå…¨ä¸€è‡´ï¼ˆé€šé“æ•°ã€feature mapå¤§å°ç­‰ï¼‰ï¼Œå› æ­¤ï¼Œè¿™é‡Œè¦ä¿®æ”¹ä¹‹å‰çš„å‚æ•°[-1, 13, 6]ï¼Œæ¥æ»¡è¶³è¿™ä¸ªè¦æ±‚ï¼š<br>-1å±‚å°±æ˜¯ä¸Šä¸€å±‚çš„è¾“å‡ºï¼ŒåŸæ¥ä¸Šä¸€å±‚çš„è¾“å‡ºchannelæ•°ä¸º256ï¼Œè¿™é‡Œæ”¹æˆ512<br>13å±‚å°±æ˜¯è¿™é‡Œ[-1, 3, C3, [512, False]], # 13<br>è¿™æ ·ä¿®æ”¹åï¼ŒBiFPN_Concatå„ä¸ªè¾“å…¥å¤§å°éƒ½æ˜¯[bs,256,40,40]<br>æœ€åBiFPN_Addåé¢çš„å‚æ•°å±‚è®¾ç½®ä¸º[256, 256]ä¹Ÿå°±æ˜¯è¾“å…¥è¾“å‡ºchannelæ•°éƒ½æ˜¯256</p><figure class="highlight plaintext"><figcaption><span>[é­”æ”¹]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs plaintext"># YOLOv5 head<br>head:<br>  [[-1, 1, Conv, [512, 1, 1]],<br>   [-1, 1, nn.Upsample, [None, 2, &#x27;nearest&#x27;]],<br>   [[-1, 6], 1, BiFPN_Concat2, [1]],  # cat backbone P4<br>   [-1, 3, C3, [512, False]],  # 13<br> <br>   [-1, 1, Conv, [256, 1, 1]],<br>   [-1, 1, nn.Upsample, [None, 2, &#x27;nearest&#x27;]],<br>   [[-1, 4], 1, BiFPN_Concat2, [1]],  # cat backbone P3<br>   [-1, 3, C3, [256, False]],  # 17 (P3/8-small)<br> <br>   [-1, 1, Conv, [256, 3, 2]],<br>   [[-1, 14,6], 1,BiFPN_Concat3, [1]],  # cat head P4<br>   [-1, 3, C3, [512, False]],  # 20 (P4/16-medium)<br> <br>   [-1, 1, Conv, [512, 3, 2]],<br>   [[-1, 10], 1, BiFPN_Concat2, [1]],  # cat head P5<br>   [-1, 3, C3, [1024, False]],  # 23 (P5/32-large)<br> <br>   [[17, 20, 23], 1, Detect, [nc, anchors]],  # Detect(P3, P4, P5)<br>  ]<br><br></code></pre></td></tr></table></figure><p><strong>3.å°†ç±»ååŠ å…¥è¿›å»ï¼Œä¿®æ”¹yolo.py</strong><br>models&#x2F;yolo.pyä¸­çš„parse_modelå‡½æ•°ä¸­æœç´¢elif m is Concat:è¯­å¥,åœ¨å…¶åé¢åŠ ä¸ŠBiFPN_Concatç›¸å…³è¯­å¥</p><figure class="highlight plaintext"><figcaption><span>[é­”æ”¹]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plaintext"># æ·»åŠ bifpn_concatç»“æ„<br>elif m in [Concat, BiFPN_Concat2, BiFPN_Concat3]:<br>    c2 = sum(ch[x] for x in f)<br><br></code></pre></td></tr></table></figure><p><strong>4. ä¿®æ”¹train.py</strong></p><figure class="highlight plaintext"><figcaption><span>[é­”æ”¹]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">#è°ƒç”¨æ¨¡å—<br>from models.common import BiFPN_Concat2, BiFPN_Concat3<br><br>#å‘ä¼˜åŒ–å™¨å™¨ä¸­æ·»åŠ BiFPNçš„æƒé‡å‚æ•°<br> pg0, pg1, pg2 = [], [], []  # optimizer parameter groups<br>    for k, v in model.named_modules():<br>        # hasattr: æµ‹è¯•æŒ‡å®šçš„å¯¹è±¡æ˜¯å¦å…·æœ‰ç»™å®šçš„å±æ€§ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼<br>        if hasattr(v, &#x27;bias&#x27;) and isinstance(v.bias, nn.Parameter):<br>            pg2.append(v.bias)  # biases<br>        if isinstance(v, nn.BatchNorm2d):<br>            pg0.append(v.weight)  # no decay<br>        elif hasattr(v, &#x27;weight&#x27;) and isinstance(v.weight, nn.Parameter):<br>            pg1.append(v.weight)  # apply decay<br> <br>        elif isinstance(v, BiFPN_Concat2) and hasattr(v, &#x27;w&#x27;) and isinstance(v.w, nn.Parameter):<br>            pg1.append(v.w)<br>        elif isinstance(v, BiFPN_Concat3) and hasattr(v, &#x27;w&#x27;) and isinstance(v.w, nn.Parameter):<br>            pg1.append(v.w)<br> <br> <br>    if opt.adam:<br>        optimizer = optim.Adam(pg0, lr=hyp[&#x27;lr0&#x27;], betas=(hyp[&#x27;momentum&#x27;], 0.999))  # adjust beta1 to momentum<br>    else:<br>        optimizer = optim.SGD(pg0, lr=hyp[&#x27;lr0&#x27;], momentum=hyp[&#x27;momentum&#x27;], nesterov=True)<br> <br>    optimizer.add_param_group(&#123;&#x27;params&#x27;: pg1, &#x27;weight_decay&#x27;: hyp[&#x27;weight_decay&#x27;]&#125;)  # add pg1 with weight_decay<br>    optimizer.add_param_group(&#123;&#x27;params&#x27;: pg2&#125;)  # add pg2 (biases)<br>    logger.info(&#x27;Optimizer groups: %g .bias, %g conv.weight, %g other&#x27; % (len(pg2), len(pg1), len(pg0)))<br>    del pg0, pg1, pg2<br></code></pre></td></tr></table></figure><p>æœ€åä¸ºäº†æ–¹ä¾¿æµ‹è¯•æ¨¡å‹é…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡®ã€æ¨¡å‹æ˜¯å¦èƒ½å¤Ÿæ­£ç¡®è¿›è¡Œå‰å‘ä¼ æ’­ï¼Œä»¥åŠæŸ¥çœ‹æ¨¡å‹çš„detectå±‚è¾“å‡ºï¼Œè‡ªå·±å°±ç¼–å†™äº†è¿™ä¸ªå‡½æ•°</p><figure class="highlight plaintext"><figcaption><span>[æ‰“å°æ¨¡å‹å‚æ•°]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">import argparse<br>import os<br>import torch<br>import yaml<br><br>from models.yolo import Model<br><br># æŒ‡å®šè¦ä½¿ç”¨çš„GPU<br>os.environ[&#x27;CUDA_VISIBLE_DEVICES&#x27;] = &#x27;0&#x27;<br><br><br>def parse_opt(known=False):<br>    parser = argparse.ArgumentParser()<br>    parser.add_argument(&#x27;--cfg&#x27;, type=str,<br>                        default=&#x27;models/yolov5s.yaml&#x27;,<br>                        help=&#x27;model.yaml path&#x27;)<br>    parser.add_argument(&#x27;--hyp&#x27;, type=str, default=&#x27;data/hyps/hyp.scratch-high.yaml&#x27;,<br>                        help=&#x27;hyperparameters path&#x27;)<br><br>    opt = parser.parse_known_args()[0] if known else parser.parse_args()<br>    return opt<br><br><br>def main(opt):<br>    with open(opt.hyp, encoding=&#x27;utf-8&#x27;, errors=&#x27;ignore&#x27;) as f:<br>        hyp = yaml.safe_load(f)  # load hyps dict å­—å…¸å½¢å¼<br><br>    # å¦‚æœé…ç½®æ–‡ä»¶ä¸­æœ‰ä¸­æ–‡ï¼Œæ‰“å¼€æ—¶è¦åŠ encoding = &#x27;utf-8&#x27;å‚æ•°<br>    with open(opt.cfg, encoding=&#x27;ascii&#x27;, errors=&#x27;ignore&#x27;) as f:<br>        cfg = yaml.safe_load(f)  # model dict å–åˆ°é…ç½®æ–‡ä»¶ä¸­æ¯æ¡çš„ä¿¡æ¯<br><br>    nc = cfg[&#x27;nc&#x27;]  # è·å–æ•°æ®é›†çš„ç±»åˆ«æ•°<br>    device = torch.device(&#x27;cuda:0&#x27;) if torch.cuda.is_available() else &#x27;cpu&#x27;<br>    print(f&#x27;device: &#123;device&#125;&#x27;)<br>    # input_img = torch.zeros(size=(1, 3, 1280, 1280))<br>    input_img = torch.zeros(size=(1, 3, 640, 640))<br>    input_img = input_img.to(device, non_blocking=True).float()<br>    print(f&#x27;the model of \&#x27;&#123;opt.cfg&#125;\&#x27; is :&#x27;)<br>    model = Model(opt.cfg, ch=3, nc=nc, anchors=hyp.get(&#x27;anchors&#x27;)).to(device)  # create<br>    output = model(input_img)<br><br>    print(f&#x27;number of detect layers: &#123;len(output)&#125;&#x27;)<br>    print(&#x27;Detect head output: &#x27;)<br>    # print(f&#x27;P2/4: &#123;output[len(output) - 4].shape&#125;&#x27;)<br>    print(f&#x27;P3/8: &#123;output[len(output) - 3].shape&#125;&#x27;)<br>    print(f&#x27;P4/16: &#123;output[len(output) - 2].shape&#125;&#x27;)<br>    print(f&#x27;P5/32: &#123;output[len(output) - 1].shape&#125;&#x27;)<br><br>    &#x27;&#x27;&#x27;<br>    3<br>    torch.Size([1, 3, 80, 80, 85])<br>    torch.Size([1, 3, 40, 40, 85])<br>    torch.Size([1, 3, 20, 20, 85])<br>    &#x27;&#x27;&#x27;<br><br><br>if __name__ == &#x27;__main__&#x27;:<br>    opt = parse_opt()<br>    main(opt)<br><br></code></pre></td></tr></table></figure><p>pytorchè·å–æ¨¡å‹æŸä¸€å±‚å‚æ•°ååŠå‚æ•°å€¼æ–¹å¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">import os<br>import torch<br>import torch.nn as nn<br><br># è®¾ç½®GPU<br>os.environ[&#x27;CUDA_VISIBLE_DEVICES&#x27;] = &#x27;1&#x27;<br>device = torch.device(&#x27;cuda:0&#x27;) if torch.cuda.is_available() else &#x27;cpu&#x27;<br><br># åˆ›å»ºæ¨¡å‹<br>model = nn.Sequential(nn.Conv2d(3, 16, kernel_size=1),<br>                      nn.Conv2d(16, 3, kernel_size=1))<br>model.to(device)<br><br># æ–¹æ³•ä¸€<br># æ‰“å°æŸä¸€å±‚çš„å‚æ•°å<br>for name in model.state_dict():<br>    print(name)<br># ç›´æ¥ç´¢å¼•æŸä¸€å±‚çš„nameæ¥è¾“å‡ºè¯¥å±‚çš„å‚æ•°<br>print(model.state_dict()[&#x27;1.weight&#x27;])<br><br># æ–¹æ³•äºŒ<br># è·å–æ¨¡å‹æ‰€æœ‰å‚æ•°åå’Œå‚æ•°å€¼ å­˜å‚¨åœ¨listä¸­<br>params = list(model.named_parameters())<br># åˆ†åˆ«ç´¢å¼•å¾—åˆ°æŸå±‚çš„åç§°å’Œå‚æ•°å€¼<br>print(params[2][0])  # name<br>print(params[2][1].data)  # data<br><br># æ–¹æ³•ä¸‰<br># ä¾æ¬¡éå†æ¨¡å‹æ¯ä¸€å±‚çš„å‚æ•° å­˜å‚¨åˆ°dictä¸­<br>params = &#123;&#125;<br>for name, param in model.named_parameters():<br>    params[name] = param.detach().cpu().numpy()<br>print(params[&#x27;0.weight&#x27;])<br><br># æ–¹æ³•å››<br># éå†æ¨¡å‹çš„æ¯ä¸€å±‚ æŸ¥æ‰¾ç›®æ ‡å±‚ è¾“å‡ºå‚æ•°å€¼<br>for layer in model.modules():<br>    # æ‰“å°Conv2då±‚çš„å‚æ•°<br>    if (isinstance(layer, nn.Conv2d)):<br>        print(layer.weight)<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/myblog/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/myblog/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="-yolov5 -head -BiFPN" scheme="https://qzpzd.github.io/myblog/tags/yolov5-head-BiFPN/"/>
    
  </entry>
  
  <entry>
    <title>(ä¸€)yolov5æ£€æµ‹å¤´headé­”æ”¹ä¹‹æ·»åŠ å°ç›®æ ‡å±‚|é’ˆå¯¹å°ç›®æ ‡æ£€æµ‹</title>
    <link href="https://qzpzd.github.io/myblog/2023/10/11/yolov5_head/"/>
    <id>https://qzpzd.github.io/myblog/2023/10/11/yolov5_head/</id>
    <published>2023-10-11T06:51:35.000Z</published>
    <updated>2023-10-12T02:50:02.526Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/myblog/css/APlayer.min.css"><script src="/myblog/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/myblog/js/Meting.min.js"></script><p><strong>1.YOLOv5ç®—æ³•ç®€ä»‹</strong></p><p>YOLOv5ä¸»è¦ç”±è¾“å…¥ç«¯ã€Backoneã€Neckä»¥åŠPredictionå››éƒ¨åˆ†ç»„æˆã€‚å…¶ä¸­ï¼š</p><p>(1) Backboneï¼šåœ¨ä¸åŒå›¾åƒç»†ç²’åº¦ä¸Šèšåˆå¹¶å½¢æˆå›¾åƒç‰¹å¾çš„å·ç§¯ç¥ç»ç½‘ç»œã€‚</p><p>(2) Neckï¼šä¸€ç³»åˆ—æ··åˆå’Œç»„åˆå›¾åƒç‰¹å¾çš„ç½‘ç»œå±‚ï¼Œå¹¶å°†å›¾åƒç‰¹å¾ä¼ é€’åˆ°é¢„æµ‹å±‚ã€‚</p><p>(3) Headï¼š å¯¹å›¾åƒç‰¹å¾è¿›è¡Œé¢„æµ‹ï¼Œç”Ÿæˆè¾¹ç•Œæ¡†å’Œå¹¶é¢„æµ‹ç±»åˆ«ã€‚</p><p>æ£€æµ‹æ¡†æ¶ï¼š</p><p><img src="https://s2.loli.net/2023/10/11/8rF7lbhcgaIORAk.png" alt="image.png"></p><p><strong>2.åŸå§‹YOLOv5æ¨¡å‹</strong></p><figure class="highlight plaintext"><figcaption><span>[åŸå§‹]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs plaintext"># YOLOv5 head<br>head:<br>  [[-1, 1, Conv, [512, 1, 1]],<br>   [-1, 1, nn.Upsample, [None, 2, &#x27;nearest&#x27;]],<br>   [[-1, 6], 1, Concat, [1]],  # cat backbone P4<br>   [-1, 3, C3, [512, False]],  # 13<br><br>   [-1, 1, Conv, [256, 1, 1]],<br>   [-1, 1, nn.Upsample, [None, 2, &#x27;nearest&#x27;]],<br>   [[-1, 4], 1, Concat, [1]],  # cat backbone P3<br>   [-1, 3, C3, [256, False]],  # 17 (P3/8-small)<br><br>   [-1, 1, Conv, [256, 3, 2]],<br>   [[-1, 14], 1, Concat, [1]],  # cat head P4<br>   [-1, 3, C3, [512, False]],  # 20 (P4/16-medium)<br><br>   [-1, 1, Conv, [512, 3, 2]],<br>   [[-1, 10], 1, Concat, [1]],  # cat head P5<br>   [-1, 3, C3, [1024, False]],  # 23 (P5/32-large)<br><br>   [[17, 20, 23], 1, Detect, [nc, anchors]],  # Detect(P3, P4, P5)<br>  ]<br><br><br></code></pre></td></tr></table></figure><p>è‹¥è¾“å…¥å›¾åƒå°ºå¯¸&#x3D;640X640ï¼Œ</p><p>P3&#x2F;8 å¯¹åº”çš„æ£€æµ‹ç‰¹å¾å›¾å¤§å°ä¸º80X80ï¼Œç”¨äºæ£€æµ‹å¤§å°åœ¨8X8ä»¥ä¸Šçš„ç›®æ ‡ã€‚</p><p>P4&#x2F;16å¯¹åº”çš„æ£€æµ‹ç‰¹å¾å›¾å¤§å°ä¸º40X40ï¼Œç”¨äºæ£€æµ‹å¤§å°åœ¨16X16ä»¥ä¸Šçš„ç›®æ ‡ã€‚</p><p>P5&#x2F;32å¯¹åº”çš„æ£€æµ‹ç‰¹å¾å›¾å¤§å°ä¸º20X20ï¼Œç”¨äºæ£€æµ‹å¤§å°åœ¨32X32ä»¥ä¸Šçš„ç›®æ ‡ã€‚</p><p><strong>3.å¢åŠ å°ç›®æ ‡æ£€æµ‹å±‚</strong></p><figure class="highlight plaintext"><figcaption><span>[é­”æ”¹]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs plaintext"><br># parameters<br>nc: 1  # number of classes<br>depth_multiple: 0.33  # model depth multiple<br>width_multiple: 0.50  # layer channel multiple<br><br># anchors<br>anchors:<br>  - [5,6, 8,14, 15,11]  #4<br>  - [10,13, 16,30, 33,23]  # P3/8<br>  - [30,61, 62,45, 59,119]  # P4/16<br>  - [116,90, 156,198, 373,326]  # P5/32<br><br># YOLOv5 backbone<br>backbone:<br>  # [from, number, module, args]<br>  [[-1, 1, Focus, [64, 3]],  # 0-P1/2<br>   [-1, 1, Conv, [128, 3, 2]],  # 1-P2/4<br>   [-1, 3, BottleneckCSP, [128]],   #160*160<br>   [-1, 1, Conv, [256, 3, 2]],  # 3-P3/8<br>   [-1, 9, BottleneckCSP, [256]],  #80*80<br>   [-1, 1, Conv, [512, 3, 2]],  # 5-P4/16<br>   [-1, 9, BottleneckCSP, [512]], #40*40<br>   [-1, 1, Conv, [1024, 3, 2]],  # 7-P5/32<br>   [-1, 1, SPP, [1024, [5, 9, 13]]],<br>   [-1, 3, BottleneckCSP, [1024, False]],  # 9   20*20<br>  ]<br><br># YOLOv5 head<br>head:<br>  [[-1, 1, Conv, [512, 1, 1]],  #20*20<br>   [-1, 1, nn.Upsample, [None, 2, &#x27;nearest&#x27;]], #40*40<br>   [[-1, 6], 1, Concat, [1]],  # cat backbone P4  40*40<br>   [-1, 3, BottleneckCSP, [512, False]],  # 13     40*40<br><br>   [-1, 1, Conv, [512, 1, 1]], #40*40<br>   [-1, 1, nn.Upsample, [None, 2, &#x27;nearest&#x27;]],<br>   [[-1, 4], 1, Concat, [1]],  # cat backbone P3   80*80<br>   [-1, 3, BottleneckCSP, [512, False]],  # 17 (P3/8-small)  80*80<br><br>   [-1, 1, Conv, [256, 1, 1]], #18  80*80<br>   [-1, 1, nn.Upsample, [None, 2, &#x27;nearest&#x27;]], #19  160*160<br>   [[-1, 2], 1, Concat, [1]], #20 cat backbone p2  160*160<br>   [-1, 3, BottleneckCSP, [256, False]], #21 160*160<br><br>   [-1, 1, Conv, [256, 3, 2]],  #22   80*80<br>   [[-1, 18], 1, Concat, [1]], #23 80*80<br>   [-1, 3, BottleneckCSP, [256, False]], #24 80*80<br><br>   [-1, 1, Conv, [256, 3, 2]], #25  40*40<br>   [[-1, 14], 1, Concat, [1]],  # 26  cat head P4  40*40<br>   [-1, 3, BottleneckCSP, [512, False]],  # 27 (P4/16-medium) 40*40<br><br>   [-1, 1, Conv, [512, 3, 2]],  #28  20*20<br>   [[-1, 10], 1, Concat, [1]],  #29 cat head P5  #20*20<br>   [-1, 3, BottleneckCSP, [1024, False]],  # 30 (P5/32-large)  20*20<br><br>   [[21, 24, 27, 30], 1, Detect, [nc, anchors]],  # Detect(p2, P3, P4, P5)<br>  ]<br><br></code></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç ä¸­æ ¹æ®ä¸åŒyolov5ç‰ˆæœ¬è¿›è¡Œé€‚å½“ä¿®æ”¹ï¼Œä¾‹å¦‚æœ‰çš„ç‰ˆæœ¬backboneç¬¬ä¸€è¡Œä¸º[-1, 1, Conv, [64, 6, 2, 2]],  # 0-P1&#x2F;2ï¼Œåˆ©ç”¨å·ç§¯å–æ¶ˆäº†Focusï¼Œæœ‰äº›ç‰ˆæœ¬æ˜¯C3æ›¿æ¢äº†C2fï¼Œbackboneç¬¬ä¸€è¡Œä¸º[-1, 1, Conv, [64, 3, 2]]  # 0-P1&#x2F;2ï¼Œå…¶å®ƒyoloç³»åˆ—å¦‚yolov7ä¸yolov8åŸç†ä¸€æ ·ï¼Œä¹‹ä¸è¿‡yolov5ä¸yolov7è®¸å“Ÿå•Šç”¨åˆ°anchorsï¼Œå› æ­¤anchorä¹Ÿéœ€è¦åœ¨åŸæ¥åŸºç¡€ä¸Šå¢åŠ ä¸€ä¸ªå¦‚ä¸Šï¼Œyolov8åˆ™ä¸éœ€è¦ï¼Œç„¶åéƒ½æ˜¯æ ¹æ®å¯¹åº”ç‰ˆæœ¬çš„åŸå§‹yamlæ–‡ä»¶è¿›è¡Œæ›´æ”¹ï¼Œåªæ›´æ”¹headéƒ¨åˆ†å³å¯ã€‚</p><p><strong># æ–°å¢åŠ 160X160çš„æ£€æµ‹ç‰¹å¾å›¾ï¼Œç”¨äºæ£€æµ‹4X4ä»¥ä¸Šçš„ç›®æ ‡ã€‚</strong></p><p>æ”¹è¿›åï¼Œè™½ç„¶è®¡ç®—é‡å’Œæ£€æµ‹é€Ÿåº¦æœ‰æ‰€å¢åŠ ï¼Œä½†å¯¹å°ç›®æ ‡çš„æ£€æµ‹ç²¾åº¦æœ‰æ˜æ˜¾æ”¹å–„ã€‚</p><p>è¿™é‡Œç»™å‡ºå…¶å®ƒyolov7ä¸yolov8é­”æ”¹çš„é“¾æ¥</p><p><a href="https://blog.csdn.net/m0_70388905/article/details/125392908">YOLOv8&#x2F;YOLOv7&#x2F;YOLOv5ç³»åˆ—ç®—æ³•æ”¹è¿›ã€NO.6ã€‘å¢åŠ å°ç›®æ ‡æ£€æµ‹å±‚ï¼Œæé«˜å¯¹å°ç›®æ ‡çš„æ£€æµ‹æ•ˆæœ_yolov5æ·»åŠ å°ç›®æ ‡æ£€æµ‹å±‚_äººå·¥æ™ºèƒ½ç®—æ³•ç ”ç©¶é™¢çš„åšå®¢-CSDNåšå®¢</a></p><p>anchoré‡æ–°èšç±»æ–¹æ³•<br><a href="https://blog.csdn.net/qq_37541097/article/details/119647026">https://blog.csdn.net/qq_37541097/article/details/119647026</a></p><p>yolov5ä¸­èšç±»anchorsä»£ç è®²è§£<br>å¦‚æœä½ æ˜¯ç›´æ¥ä½¿ç”¨yolov5çš„è®­ç»ƒè„šæœ¬ï¼Œé‚£ä¹ˆå®ƒä¼šè‡ªåŠ¨å»è®¡ç®—ä¸‹é»˜è®¤çš„anchorsä¸ä½ æ•°æ®é›†ä¸­æ‰€æœ‰ç›®æ ‡çš„best possible recallï¼Œå¦‚æœå°äº0.98å°±ä¼šæ ¹æ®ä½ è‡ªå·±æ•°æ®é›†çš„ç›®æ ‡å»é‡æ–°èšç±»ç”Ÿæˆanchorsï¼Œåä¹‹ä½¿ç”¨é»˜è®¤çš„anchorsã€‚</p><p>ä¸‹é¢ä»£ç æ˜¯æˆ‘æ ¹æ®yolov5ä¸­èšç±»anchorsçš„ä»£ç ç®€å•ä¿®æ”¹å¾—åˆ°çš„ã€‚åŸºæœ¬æµç¨‹ä¸å˜ï¼Œä¸»è¦æ”¹åŠ¨äº†ä¸‰ç‚¹ï¼š1.å¯¹ä»£ç åšäº†äº›ç®€åŒ–ã€‚2.æŠŠä½¿ç”¨pytorchçš„åœ°æ–¹éƒ½æ”¹æˆäº†numpyï¼ˆæ„Ÿè§‰è¿™æ ·ä¼šæ›´é€šç”¨ç‚¹ï¼Œä½†numpyæ•ˆç‡ç¡®å®æ²¡æœ‰pytorché«˜ï¼‰ã€‚3.ä½œè€…é»˜è®¤ä½¿ç”¨çš„k-meansæ–¹æ³•æ˜¯scipyåŒ…æä¾›çš„ï¼Œä½¿ç”¨çš„æ˜¯æ¬§å¼è·ç¦»ã€‚æˆ‘è‡ªå·±æ”¹æˆäº†åŸºäº1-IOU(bboxes, anchors)è·ç¦»çš„æ–¹æ³•ã€‚å½“ç„¶æˆ‘åªæ˜¯æ³¨é‡Šæ‰äº†ä½œè€…åŸæ¥çš„æ–¹æ³•ï¼Œå¦‚æœæƒ³ç”¨è‡ªå·±æŠŠæ³¨é‡Šå–æ¶ˆæ‰å°±è¡Œäº†ã€‚ä½†åœ¨æˆ‘ä½¿ç”¨æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œè¿˜æ˜¯åŸºäº1-IOU(bboxes, anchors)è·ç¦»çš„æ–¹æ³•ä¼šç•¥å¥½ç‚¹ã€‚</p><p>å®Œæ•´ä»£ç é“¾æ¥ï¼š<br><a href="https://github.com/WZMIAOMIAO/deep-learning-for-image-processing/tree/master/others_project/kmeans_anchors">https://github.com/WZMIAOMIAO/deep-learning-for-image-processing/tree/master/others_project/kmeans_anchors</a></p><p>å…¶å®åœ¨yolov5ç”Ÿæˆanchorsä¸­ä¸ä»…ä»…ä½¿ç”¨äº†k-meansèšç±»ï¼Œè¿˜ä½¿ç”¨äº†Genetic Algorithmé—ä¼ ç®—æ³•ï¼Œåœ¨k-meansèšç±»çš„ç»“æœä¸Šè¿›è¡Œmutationå˜å¼‚ã€‚æ¥ä¸‹æ¥ç®€å•ä»‹ç»ä¸‹ä»£ç æµç¨‹ï¼š</p><p>è¯»å–è®­ç»ƒé›†ä¸­æ¯å¼ å›¾ç‰‡çš„whä»¥åŠæ‰€æœ‰bboxesçš„whï¼ˆè¿™é‡Œæ˜¯æˆ‘è‡ªå·±å†™çš„è„šæœ¬è¯»å–çš„PASCAL VOCæ•°æ®ï¼‰<br>å°†æ¯å¼ å›¾ç‰‡ä¸­whçš„æœ€å¤§å€¼ç­‰æ¯”ä¾‹ç¼©æ”¾åˆ°æŒ‡å®šå¤§å°img_sizeï¼Œç”±äºè¯»å–çš„bboxesæ˜¯ç›¸å¯¹åæ ‡æ‰€ä»¥ä¸éœ€è¦æ”¹åŠ¨<br>å°†bboxesä»ç›¸å¯¹åæ ‡æ”¹æˆç»å¯¹åæ ‡ï¼ˆä¹˜ä»¥ç¼©æ”¾åçš„whï¼‰<br>ç­›é€‰bboxesï¼Œä¿ç•™whéƒ½å¤§äºç­‰äºä¸¤ä¸ªåƒç´ çš„bboxes<br>ä½¿ç”¨k-meansèšç±»å¾—åˆ°nä¸ªanchors<br>ä½¿ç”¨é—ä¼ ç®—æ³•éšæœºå¯¹anchorsçš„whè¿›è¡Œå˜å¼‚ï¼Œå¦‚æœå˜å¼‚åæ•ˆæœå˜å¾—æ›´å¥½ï¼ˆä½¿ç”¨anchor_fitnessæ–¹æ³•è®¡ç®—å¾—åˆ°çš„fitnessï¼ˆé€‚åº”åº¦ï¼‰è¿›è¡Œè¯„ä¼°ï¼‰å°±å°†å˜å¼‚åçš„ç»“æœèµ‹å€¼ç»™anchorsï¼Œå¦‚æœå˜å¼‚åæ•ˆæœå˜å·®å°±è·³è¿‡ï¼Œé»˜è®¤å˜å¼‚1000æ¬¡ã€‚<br>å°†æœ€ç»ˆå˜å¼‚å¾—åˆ°çš„anchorsæŒ‰ç…§é¢ç§¯è¿›è¡Œæ’åºå¹¶è¿”å›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">import random<br>import numpy as np<br>from tqdm import tqdm<br>from scipy.cluster.vq import kmeans<br><br>from read_voc import VOCDataSet<br>from yolo_kmeans import k_means, wh_iou<br><br><br>def anchor_fitness(k: np.ndarray, wh: np.ndarray, thr: float):  # mutation fitness<br>    r = wh[:, None] / k[None]<br>    x = np.minimum(r, 1. / r).min(2)  # ratio metric<br>    # x = wh_iou(wh, k)  # iou metric<br>    best = x.max(1)<br>    f = (best * (best &gt; thr).astype(np.float32)).mean()  # fitness<br>    bpr = (best &gt; thr).astype(np.float32).mean()  # best possible recall<br>    return f, bpr<br><br><br>def main(img_size=512, n=9, thr=0.25, gen=1000):<br>    # ä»æ•°æ®é›†ä¸­è¯»å–æ‰€æœ‰å›¾ç‰‡çš„whä»¥åŠå¯¹åº”bboxesçš„wh<br>    dataset = VOCDataSet(voc_root=&quot;/data&quot;, year=&quot;2012&quot;, txt_name=&quot;train.txt&quot;)<br>    im_wh, boxes_wh = dataset.get_info()<br><br>    # æœ€å¤§è¾¹ç¼©æ”¾åˆ°img_size<br>    im_wh = np.array(im_wh, dtype=np.float32)<br>    shapes = img_size * im_wh / im_wh.max(1, keepdims=True)<br>    wh0 = np.concatenate([l * s for s, l in zip(shapes, boxes_wh)])  # wh<br><br>    # Filter è¿‡æ»¤æ‰å°ç›®æ ‡<br>    i = (wh0 &lt; 3.0).any(1).sum()<br>    if i:<br>        print(f&#x27;WARNING: Extremely small objects found. &#123;i&#125; of &#123;len(wh0)&#125; labels are &lt; 3 pixels in size.&#x27;)<br>    wh = wh0[(wh0 &gt;= 2.0).any(1)]  # åªä¿ç•™whéƒ½å¤§äºç­‰äº2ä¸ªåƒç´ çš„box<br><br>    # Kmeans calculation<br>    # print(f&#x27;Running kmeans for &#123;n&#125; anchors on &#123;len(wh)&#125; points...&#x27;)<br>    # s = wh.std(0)  # sigmas for whitening<br>    # k, dist = kmeans(wh / s, n, iter=30)  # points, mean distance<br>    # assert len(k) == n, print(f&#x27;ERROR: scipy.cluster.vq.kmeans requested &#123;n&#125; points but returned only &#123;len(k)&#125;&#x27;)<br>    # k *= s<br>    k = k_means(wh, n)<br><br>    # æŒ‰é¢ç§¯æ’åº<br>    k = k[np.argsort(k.prod(1))]  # sort small to large<br>    f, bpr = anchor_fitness(k, wh, thr)<br>    print(&quot;kmeans: &quot; + &quot; &quot;.join([f&quot;[&#123;int(i[0])&#125;, &#123;int(i[1])&#125;]&quot; for i in k]))<br>    print(f&quot;fitness: &#123;f:.5f&#125;, best possible recall: &#123;bpr:.5f&#125;&quot;)<br><br>    # Evolve<br>    # é—ä¼ ç®—æ³•(åœ¨kmeansçš„ç»“æœåŸºç¡€ä¸Šå˜å¼‚mutation)<br>    npr = np.random<br>    f, sh, mp, s = anchor_fitness(k, wh, thr)[0], k.shape, 0.9, 0.1  # fitness, generations, mutation prob, sigma<br>    pbar = tqdm(range(gen), desc=f&#x27;Evolving anchors with Genetic Algorithm:&#x27;)  # progress bar<br>    for _ in pbar:<br>        v = np.ones(sh)<br>        while (v == 1).all():  # mutate until a change occurs (prevent duplicates)<br>            v = ((npr.random(sh) &lt; mp) * random.random() * npr.randn(*sh) * s + 1).clip(0.3, 3.0)<br>        kg = (k.copy() * v).clip(min=2.0)<br>        fg, bpr = anchor_fitness(kg, wh, thr)<br>        if fg &gt; f:<br>            f, k = fg, kg.copy()<br>            pbar.desc = f&#x27;Evolving anchors with Genetic Algorithm: fitness = &#123;f:.4f&#125;&#x27;<br><br>    # æŒ‰é¢ç§¯æ’åº<br>    k = k[np.argsort(k.prod(1))]  # sort small to large<br>    print(&quot;genetic: &quot; + &quot; &quot;.join([f&quot;[&#123;int(i[0])&#125;, &#123;int(i[1])&#125;]&quot; for i in k]))<br>    print(f&quot;fitness: &#123;f:.5f&#125;, best possible recall: &#123;bpr:.5f&#125;&quot;)<br><br><br>if __name__ == &quot;__main__&quot;:<br>    main()<br><br></code></pre></td></tr></table></figure><h1 id="èšç±»anchorséœ€è¦æ³¨æ„çš„å‘"><a href="#èšç±»anchorséœ€è¦æ³¨æ„çš„å‘" class="headerlink" title="èšç±»anchorséœ€è¦æ³¨æ„çš„å‘"></a>èšç±»anchorséœ€è¦æ³¨æ„çš„å‘</h1><p>æœ‰æ—¶ä½¿ç”¨è‡ªå·±èšç±»å¾—åˆ°çš„anchorsçš„æ•ˆæœåè€Œå˜å·®äº†ï¼Œæ­¤æ—¶ä½ å¯ä»¥ä»ä»¥ä¸‹å‡ æ–¹é¢è¿›è¡Œæ£€æŸ¥ï¼š</p><p>æ³¨æ„è¾“å…¥ç½‘ç»œæ—¶è®­ç»ƒçš„å›¾ç‰‡å°ºå¯¸ã€‚è¿™æ˜¯ä¸ªå¾ˆé‡è¦çš„ç‚¹ï¼Œå› ä¸ºä¸€èˆ¬è®­ç»ƒ&#x2F;éªŒè¯æ—¶è¾“å…¥ç½‘ç»œçš„å›¾ç‰‡å°ºå¯¸æ˜¯å›ºå®šçš„ï¼Œæ¯”å¦‚è¯´640x640ï¼Œé‚£ä¹ˆå›¾ç‰‡åœ¨è¾“å…¥ç½‘ç»œå‰ä¸€èˆ¬ä¼šå°†æœ€å¤§è¾¹é•¿ç¼©æ”¾åˆ°640ï¼ŒåŒæ—¶å›¾ç‰‡ä¸­çš„bboxesä¹Ÿä¼šè¿›è¡Œç¼©æ”¾ã€‚æ‰€ä»¥åœ¨èšç±»anchorsæ—¶éœ€è¦ä½¿ç”¨ç›¸åŒçš„æ–¹å¼æå‰å»ç¼©æ”¾bboxesï¼Œå¦åˆ™èšç±»å‡ºæ¥çš„anchorså¹¶ä¸åŒ¹é…ã€‚æ¯”å¦‚ä½ çš„å›¾ç‰‡éƒ½æ˜¯1280x1280å¤§å°çš„ï¼Œå‡è®¾bboxeséƒ½æ˜¯100x100å¤§å°çš„ï¼Œå¦‚æœä¸å»ç¼©æ”¾bboxesï¼Œé‚£ä¹ˆèšç±»å¾—åˆ°çš„anchorså·®ä¸å¤šæ˜¯åœ¨100x100é™„è¿‘ã€‚è€Œå®é™…è®­ç»ƒç½‘ç»œæ—¶bboxeséƒ½å·²ç»ç¼©æ”¾åˆ°50x50å¤§å°äº†ï¼Œæ­¤æ—¶ç†æƒ³çš„anchorsåº”è¯¥æ˜¯50x50å·¦å³è€Œä¸æ˜¯100x100äº†ã€‚<br>å¦‚æœä½¿ç”¨é¢„è®­ç»ƒæƒé‡ï¼Œä¸è¦å†»ç»“å¤ªå¤šçš„æƒé‡ã€‚ç°åœ¨è®­ç»ƒè‡ªå·±æ•°æ®é›†æ—¶ä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨åˆ«äººåœ¨cocoç­‰å¤§å‹æ•°æ®ä¸Šé¢„è®­ç»ƒå¥½çš„æƒé‡ã€‚è€Œè¿™äº›æƒé‡æ˜¯åŸºäºcocoç­‰æ•°æ®é›†ä¸Šèšç±»å¾—åˆ°çš„ç»“æœï¼Œå¹¶ä¸æ˜¯é’ˆå¯¹è‡ªå·±æ•°æ®é›†èšç±»å¾—åˆ°çš„ã€‚æ‰€ä»¥ç½‘ç»œä¸ºäº†è¦é€‚åº”æ–°çš„anchorséœ€è¦è°ƒæ•´å¾ˆå¤šæƒé‡ï¼Œå¦‚æœä½ å†»ç»“äº†å¾ˆå¤šå±‚ï¼ˆå‡è®¾åªå»å¾®è°ƒæœ€åçš„é¢„æµ‹å™¨ï¼Œå…¶ä»–æƒé‡å…¨éƒ¨å†»ç»“ï¼‰ï¼Œé‚£ä¹ˆå¾—åˆ°çš„ç»“æœå¾ˆå¤§å‡ ç‡è¿˜æ²¡æœ‰ä¹‹å‰çš„anchorså¥½ã€‚å½“å¯è®­ç»ƒçš„æƒé‡è¶Šæ¥è¶Šå¤šï¼Œä¸€èˆ¬ä½¿ç”¨è‡ªå·±æ•°æ®é›†èšç±»å¾—åˆ°çš„anchorsä¼šæ›´å¥½ä¸€ç‚¹ï¼ˆå‰ææ˜¯è‡ªå·±èšç±»çš„anchorsæ˜¯åˆç†çš„ï¼‰ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/myblog/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/myblog/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="-yolov5 -head" scheme="https://qzpzd.github.io/myblog/tags/yolov5-head/"/>
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="https://qzpzd.github.io/myblog/2023/10/09/hello-world/"/>
    <id>https://qzpzd.github.io/myblog/2023/10/09/hello-world/</id>
    <published>2023-10-09T11:05:01.773Z</published>
    <updated>2023-10-09T11:05:01.773Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/myblog/css/APlayer.min.css"><script src="/myblog/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/myblog/js/Meting.min.js"></script><p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo new <span class="hljs-string">&quot;My New Post&quot;</span><br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo server<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo generate<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo deploy<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/myblog/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/myblog/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>decorator</title>
    <link href="https://qzpzd.github.io/myblog/2023/08/10/decorator/"/>
    <id>https://qzpzd.github.io/myblog/2023/08/10/decorator/</id>
    <published>2023-08-10T06:51:35.000Z</published>
    <updated>2023-10-09T11:05:01.773Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/myblog/css/APlayer.min.css"><script src="/myblog/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/myblog/js/Meting.min.js"></script><h1 id="1ã€-timer-æµ‹é‡æ‰§è¡Œæ—¶é—´"><a href="#1ã€-timer-æµ‹é‡æ‰§è¡Œæ—¶é—´" class="headerlink" title="1ã€@timer:æµ‹é‡æ‰§è¡Œæ—¶é—´"></a>1ã€@timer:æµ‹é‡æ‰§è¡Œæ—¶é—´</h1><p>@timerè£…é¥°å™¨å¯ä»¥å¸®åŠ©æˆ‘ä»¬è·Ÿè¸ªç‰¹å®šå‡½æ•°çš„æ‰§è¡Œæ—¶é—´ã€‚é€šè¿‡ç”¨è¿™ä¸ªè£…é¥°å™¨åŒ…è£…å‡½æ•°ï¼Œæˆ‘å¯ä»¥å¿«é€Ÿè¯†åˆ«ç“¶é¢ˆå¹¶ä¼˜åŒ–ä»£ç çš„å…³é”®éƒ¨åˆ†ã€‚</p><figure class="highlight plaintext"><figcaption><span>[æµ‹é‡æ‰§è¡Œæ—¶é—´]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">import time<br> <br>def timer(func):<br>   def wrapper(*args, **kwargs):<br>       start_time = time.time()<br>       result = func(*args, **kwargs)<br>       end_time = time.time()<br>       print(f&quot;&#123;func.__name__&#125; took &#123;end_time - start_time:.2f&#125; seconds to execute.&quot;)<br>       return result<br>   return wrapper<br>@timer<br>def my_data_processing_function():<br>   # Your data processing code here<br><br></code></pre></td></tr></table></figure><h1 id="2-log-results-æ—¥å¿—è¾“å‡º"><a href="#2-log-results-æ—¥å¿—è¾“å‡º" class="headerlink" title="2.@log_results:æ—¥å¿—è¾“å‡º"></a>2.@log_results:æ—¥å¿—è¾“å‡º</h1><p>åœ¨è¿è¡Œå¤æ‚çš„æ•°æ®åˆ†ææ—¶ï¼Œè·Ÿè¸ªæ¯ä¸ªå‡½æ•°çš„è¾“å‡ºå˜å¾—è‡³å…³é‡è¦ã€‚@log_resultsè£…é¥°å™¨å¯ä»¥å¸®åŠ©æˆ‘ä»¬è®°å½•å‡½æ•°çš„ç»“æœï¼Œä»¥ä¾¿äºè°ƒè¯•å’Œç›‘æ§</p><figure class="highlight plaintext"><figcaption><span>[æ—¥å¿—è¾“å‡º]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">def log_results(func):<br>    def wrapper(*args, **kwargs):<br>        result = func(*args, **kwargs)<br>        with open(&quot;results.log&quot;, &quot;a&quot;) as log_file:<br>            log_file.write(f&quot;&#123;func.__name__&#125; - Result: &#123;result&#125;\n&quot;)<br>        return result<br> <br>    return wrapper<br> @log_results<br>def calculate_metrics(data):<br>   # Your metric calculation code here<br><br></code></pre></td></tr></table></figure><h1 id="3-suppress-errors-ä¼˜é›…çš„é”™è¯¯å¤„ç†"><a href="#3-suppress-errors-ä¼˜é›…çš„é”™è¯¯å¤„ç†" class="headerlink" title="3.@suppress_errors:ä¼˜é›…çš„é”™è¯¯å¤„ç†"></a>3.@suppress_errors:ä¼˜é›…çš„é”™è¯¯å¤„ç†</h1><p>@suppress_errorsè£…é¥°å™¨å¯ä»¥ä¼˜é›…åœ°å¤„ç†å¼‚å¸¸å¹¶ç»§ç»­æ‰§è¡Œ,å¯ä»¥é¿å…éšè—ä¸¥é‡é”™è¯¯ï¼Œè¿˜å¯ä»¥è¿›è¡Œé”™è¯¯çš„è¯¦ç»†è¾“å‡ºï¼Œä¾¿äºè°ƒè¯•.</p><figure class="highlight plaintext"><figcaption><span>[é”™è¯¯å¤„ç†]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">def suppress_errors(func):<br>    def wrapper(*args, **kwargs):<br>        try:<br>            return func(*args, **kwargs)<br>        except Exception as e:<br>            print(f&quot;Error in &#123;func.__name__&#125;: &#123;e&#125;&quot;)<br>            return None<br> <br>    return wrapper<br>@suppress_errors<br>def preprocess_data(data):<br>   # Your data preprocessing code here<br><br></code></pre></td></tr></table></figure><h1 id="4-debug-è°ƒè¯•å˜å¾—æ›´å®¹æ˜“"><a href="#4-debug-è°ƒè¯•å˜å¾—æ›´å®¹æ˜“" class="headerlink" title="4.@debug:è°ƒè¯•å˜å¾—æ›´å®¹æ˜“"></a>4.@debug:è°ƒè¯•å˜å¾—æ›´å®¹æ˜“</h1><p>è°ƒè¯•å¤æ‚çš„ä»£ç å¯èƒ½éå¸¸è€—æ—¶ã€‚@debugè£…é¥°å™¨å¯ä»¥æ‰“å°å‡½æ•°çš„è¾“å…¥å‚æ•°å’Œå®ƒä»¬çš„å€¼ï¼Œä»¥ä¾¿äºè°ƒè¯•:</p><figure class="highlight plaintext"><figcaption><span>[è°ƒè¯•]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">def debug(func):<br>    def wrapper(*args, **kwargs):<br>        print(f&quot;Debugging &#123;func.__name__&#125; - args: &#123;args&#125;, kwargs: &#123;kwargs&#125;&quot;)<br>        return func(*args, **kwargs)<br> <br>    return wrapper<br>@debug<br>def complex_data_processing(data, threshold=0.5):<br>   # Your complex data processing code here<br><br></code></pre></td></tr></table></figure><blockquote><blockquote><p>1.@timer:æµ‹é‡æ‰§è¡Œæ—¶é—´<br>2.@log_results:æ—¥å¿—è¾“å‡º<br>3.@suppress_errors:ä¼˜é›…çš„é”™è¯¯å¤„ç†<br>4.@debug:è°ƒè¯•å˜å¾—æ›´å®¹æ˜“</p></blockquote><footer><strong>æ•°æ®STUDIO</strong><cite>- source [https://mp.weixin.qq.com/s/JFaH_GqOFMARnzyWqV2TFQ] [10ä¸ªç®€å•ä½†å¾ˆæœ‰ç”¨çš„Pythonè£…é¥°å™¨]</cite></footer></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/myblog/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/myblog/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="-python -decorator" scheme="https://qzpzd.github.io/myblog/tags/python-decorator/"/>
    
  </entry>
  
  <entry>
    <title>onnxæ¨¡å‹å’Œæ‰‹åŠ¨ç”Ÿæˆanchorsæ–‡ä»¶è¿›è¡Œåå¤„ç†ä¸æµ‹è¯•</title>
    <link href="https://qzpzd.github.io/myblog/2023/08/10/onnx_detect/"/>
    <id>https://qzpzd.github.io/myblog/2023/08/10/onnx_detect/</id>
    <published>2023-08-10T06:51:35.000Z</published>
    <updated>2023-10-12T09:53:43.196Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/myblog/css/APlayer.min.css"><script src="/myblog/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/myblog/js/Meting.min.js"></script><p>è®­ç»ƒå¥½çš„æ·±åº¦å­¦ä¹ æ¨¡å‹é€šå¸¸éœ€è¦è½¬æ¢ä¸ºonnxæ¨¡å‹ï¼Œå®˜æ–¹æœ‰onnxçš„æµ‹è¯•ä»£ç ï¼Œè¿™é‡Œé‡æ–°è¿›è¡Œæ„å»ºï¼Œå¹¶æ‰‹åŠ¨ç”Ÿæˆanchoræ–‡ä»¶ï¼Œè¿›è¡Œonnxæ¨¡å‹æµ‹è¯•ï¼Œå¯¹äºè¾“å…¥å›¾åƒå‰å¤„ç†ä¹Ÿåˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œä¸€ä¸ªåŒ…å«letterboxï¼›ä¸€ä¸ªä¸åŒ…å«ç›´æ¥resizeï¼Œæ˜¾ç„¶åä¸€ä¸ªç²¾åº¦ä¼šæœ‰å¤šé™ä½</p><h1 id="åå¤„ç†"><a href="#åå¤„ç†" class="headerlink" title="åå¤„ç†"></a>åå¤„ç†</h1><figure class="highlight plaintext"><figcaption><span>[åå¤„ç†]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">import onnxruntime<br>import cv2<br>import numpy as np<br>import torch<br>#---------------------NMS--------------------------------------------------------------------<br>def py_cpu_nms(dets0, conf_thresh, iou_thresh):<br>    &quot;&quot;&quot;Pure Python NMS baseline.&quot;&quot;&quot;<br>    nc = dets0.shape[1] - 5<br>    dets = dets0[dets0[:, 4] &gt; conf_thresh]<br>    dets = xywh2xyxy(dets)<br>    <br>    keep_all = []<br>    for cls in range(nc):<br>        dets_single = dets[np.argmax(dets[:,5:],axis=1)==cls]<br>        #print(&#x27;dets_single %d&#x27;%cls,dets_single)<br>        x1 = dets_single[:, 0]<br>        y1 = dets_single[:, 1]<br>        x2 = dets_single[:, 2]<br>        y2 = dets_single[:, 3]<br>        scores = dets_single[:, 4]<br>        areas = (x2 - x1 + 1) * (y2 - y1 + 1) <br>        order = scores.argsort()[::-1]<br>        keep = []<br>        while order.size &gt; 0:<br>            i = order[0]<br>            keep.append(i)  <br>            xx1 = np.maximum(x1[i], x1[order[1:]])<br>            yy1 = np.maximum(y1[i], y1[order[1:]])<br>            xx2 = np.minimum(x2[i], x2[order[1:]])<br>            yy2 = np.minimum(y2[i], y2[order[1:]])<br>            w = np.maximum(0.0, xx2 - xx1 + 1)<br>            h = np.maximum(0.0, yy2 - yy1 + 1)<br>            inter = w * h<br>            ovr = inter / (areas[i] + areas[order[1:]] - inter)<br>            inds = np.where(ovr &lt;= iou_thresh)[0]<br>            order = order[inds + 1]<br>        keep_rect = dets_single[keep]<br>        #print(&#x27;keep&#x27;,keep)<br>        keep_all.extend(keep_rect)<br>    return keep_all<br><br>def xywh2xyxy(x):<br>    # Convert nx4 boxes from [x, y, w, h] to [x1, y1, x2, y2] where xy1=top-left, xy2=bottom-right<br>    y = np.zeros_like(x)<br>    y[:, 0] = x[:, 0] - x[:, 2] / 2  # top left x<br>    y[:, 1] = x[:, 1] - x[:, 3] / 2  # top left y<br>    y[:, 2] = x[:, 0] + x[:, 2] / 2  # bottom right x<br>    y[:, 3] = x[:, 1] + x[:, 3] / 2  # bottom right y<br>    y[:, 4:] = x[:,4:]<br>    return y<br><br>#---------------------img_preprocess-----------------------------------------------------------------<br>def img_preprocess(frame,imgsz):<br>    # im = letterbox(frame, imgsz)[0]<br>    im = cv2.resize(frame,(640,384))<br>    im = im.transpose((2, 0, 1))[::-1]  # HWC to CHW, BGR to RGB<br>    im = np.ascontiguousarray(im)  # contiguous<br>    im = np.asarray(im, dtype=np.float32)<br>    im = np.expand_dims(im, 0)<br>    im /= 255.0<br>    return im<br><br>#---------------------------letterbox------------------------------------------------------------------<br>def letterbox(im, new_shape=(640, 640), color=(114, 114, 114), auto=True, scaleFill=False, scaleup=True, stride=32):<br>    # Resize and pad image while meeting stride-multiple constraints<br>    shape = im.shape[:2]  # current shape [height, width]<br>    if isinstance(new_shape, int):<br>        new_shape = (new_shape, new_shape)<br><br>    # Scale ratio (new / old)<br>    r = min(new_shape[0] / shape[0], new_shape[1] / shape[1])<br>    if not scaleup:  # only scale down, do not scale up (for better val mAP)<br>        r = min(r, 1.0)<br>    <br>    # Compute padding<br>    ratio = r, r  # width, height ratios<br>    new_unpad = int(round(shape[1] * r)), int(round(shape[0] * r))<br>    dw, dh = new_shape[1] - new_unpad[0], new_shape[0] - new_unpad[1]  # wh padding<br>    if auto:  # minimum rectangle<br>        dw, dh = np.mod(dw, stride), np.mod(dh, stride)  # wh padding<br>    elif scaleFill:  # stretch<br>        dw, dh = 0.0, 0.0<br>        new_unpad = (new_shape[1], new_shape[0])<br>        ratio = new_shape[1] / shape[1], new_shape[0] / shape[0]  # width, height ratios<br>    <br>    dw /= 2  # divide padding into 2 sides<br>    dh /= 2<br>    <br>    if shape[::-1] != new_unpad:  # resize<br>        im = cv2.resize(im, new_unpad, interpolation=cv2.INTER_LINEAR)<br>    top, bottom = int(round(dh - 0.1)), int(round(dh + 0.1))<br>    left, right = int(round(dw - 0.1)), int(round(dw + 0.1))<br>    im = cv2.copyMakeBorder(im, top, bottom, left, right, cv2.BORDER_CONSTANT, value=color)  # add border<br>    return im, ratio, (dw, dh)<br><br>#-----------------------------decode----------------------------------------<br>def np_sigmoid(x):<br>    return 1.0/(1.0+1.0/np.exp(x))<br>    <br>def decode_output(pred_raw_data,anchor_txt):<br>    pred_raw_data = np_sigmoid(pred_raw_data)<br>    print(max(pred_raw_data[:, 4]))<br>    pred_raw_data[:, 0] = (pred_raw_data[:, 0] * 2. - 0.5 + anchor_txt[:, 0]) * anchor_txt[:, 4] #x<br>    pred_raw_data[:, 1] = (pred_raw_data[:, 1] * 2. - 0.5 + anchor_txt[:, 1]) * anchor_txt[:, 4] #y<br>    pred_raw_data[:, 2] = (pred_raw_data[:, 2] * 2) ** 2 * anchor_txt[:, 2]  # w<br>    pred_raw_data[:, 3] = (pred_raw_data[:, 3] * 2) ** 2 * anchor_txt[:, 3]  # h<br>    <br>    return pred_raw_data<br><br>#-------------------------scale_ratio------------------------------------------------------<br>def helmet_scale_ratio(each,frame,imgsz=640):<br>    ratio = (frame.shape[0] /384 , frame.shape[1] / imgsz)<br>    each[[0, 2]] *= ratio[1]<br>    each[[1, 3]] *= ratio[0]<br>    return each<br>     <br>#---------------------helmet_detect----------------------------------------------------------------------------<br>def helmet_detect(face_model,frame):<br>    anchors = np.fromfile(&#x27;C:/Users/suso/Desktop/yolov5_fire/yolov5_fire_priorbox_384-640.txt&#x27;,sep=&#x27; &#x27;)<br>    anchors = anchors.reshape(-1,5)<br>    imgsz = 640<br>    img = img_preprocess(frame,imgsz) <br><br>    session = onnxruntime.InferenceSession(face_model)<br>    in_name = [input.name for input in session.get_inputs()][0]<br>    out_name = [output.name for output in session.get_outputs()]              <br>    pred = session.run(out_name,&#123;in_name: img&#125;)  <br><br><br>â€‹    <br>    x1 = np.array(pred[0]).reshape(-1, 6)<br>    x2 = np.array(pred[1]).reshape(-1, 6)<br>    x3 = np.array(pred[2]).reshape(-1, 6)<br>    print(x3.shape,max(x3[:,4]))<br>    <br>    try:<br>        # Save x1 to file<br>        np.savetxt(&quot;C:/Users\suso\Desktop/yolov5_fire/x1.txt&quot;, x1, delimiter=&#x27; &#x27;, fmt=&#x27;%f&#x27;)<br>        # Save x2 to file<br>        np.savetxt(&quot;C:/Users\suso\Desktop/yolov5_fire/x2.txt&quot;, x2, delimiter=&#x27; &#x27;, fmt=&#x27;%f&#x27;)<br>        # Save x3 to file<br>        np.savetxt(&quot;C:/Users\suso\Desktop/yolov5_fire/x3.txt&quot;, x3, delimiter=&#x27; &#x27;, fmt=&#x27;%f&#x27;)<br>    except Exception as e:<br>        print(f&quot;An error occurred: &#123;str(e)&#125;&quot;)<br>    <br>    out_data_raw = np.vstack((x1,x2,x3))<br>    np.savetxt(&quot;C:/Users\suso\Desktop/yolov5_fire/x4.txt&quot;, out_data_raw, delimiter=&#x27; &#x27;, fmt=&#x27;%f&#x27;)<br>    output_from_txt = decode_output(out_data_raw,anchors)<br>    <br>    print(len(pred),pred[0].shape)<br>    print(&quot;ffffffffff&quot;,max(np.array(pred[0]).reshape(-1, 6)[:,4]))<br>    # pred = py_cpu_nms(np.array(pred[0]).reshape(-1, 6), 0.2, 0.45)<br>    pred = py_cpu_nms(output_from_txt, 0.2, 0.45)<br>    <br>    return pred,img<br><br>#---------------draw--------------------------------------------<br>def drawHelmetBox(frame,bbox):<br>    print(bbox)<br>    cv2.rectangle(frame, (int(bbox[0]), int(bbox[1])), (int(bbox[2]), int(bbox[3])), (0, 255, 0), 3)<br>    label = f&#x27;&#123;float(bbox[4]*bbox[5]):.2f&#125;&#x27;<br>    cv2.putText(frame, label, (int(bbox[0]), int(bbox[1])+20), 0, 1, [0, 255, 0], thickness=2, lineType=cv2.LINE_AA)<br>    cv2.imshow(&#x27;frame&#x27;,frame)<br>    cv2.waitKey(0)<br>    cv2.destroyAllWindows()<br><br>def scale_boxes(img1_shape, boxes, img0_shape, ratio_pad=None):<br>    # Rescale boxes (xyxy) from img1_shape to img0_shape<br>    if ratio_pad is None:  # calculate from img0_shape<br>        gain = min(img1_shape[0] / img0_shape[0], img1_shape[1] / img0_shape[1])  # gain  = old / new<br>        pad = (img1_shape[1] - img0_shape[1] * gain) / 2, (img1_shape[0] - img0_shape[0] * gain) / 2  # wh padding<br>    else:<br>        gain = ratio_pad[0][0]<br>        pad = ratio_pad[1]<br><br>    boxes[..., [0, 2]] -= pad[0]  # x padding<br>    boxes[..., [1, 3]] -= pad[1]  # y padding<br>    boxes[..., :4] /= gain<br>    clip_boxes(boxes, img0_shape)<br>    return boxes<br><br>def clip_boxes(boxes, shape):<br>    # Clip boxes (xyxy) to image shape (height, width)<br>    if isinstance(boxes, torch.Tensor):  # faster individually<br>        boxes[..., 0].clamp_(0, shape[1])  # x1<br>        boxes[..., 1].clamp_(0, shape[0])  # y1<br>        boxes[..., 2].clamp_(0, shape[1])  # x2<br>        boxes[..., 3].clamp_(0, shape[0])  # y2<br>    else:  # np.array (faster grouped)<br>        boxes[..., [0, 2]] = boxes[..., [0, 2]].clip(0, shape[1])  # x1, x2<br>        boxes[..., [1, 3]] = boxes[..., [1, 3]].clip(0, shape[0])  # y1, y2<br></code></pre></td></tr></table></figure><h1 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h1><figure class="highlight plaintext"><figcaption><span>[æµ‹è¯•]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">import cv2<br>import os<br>from HelmetDetection import helmet_detect,helmet_scale_ratio,drawHelmetBox,scale_boxes<br><br># image_path = &#x27;C:/Users/suso/Desktop/yolov5_fire/frame_01_jpg.rf.7a9e0fe6e03efe5b3df01c7322aff0dc.jpg&#x27;<br>face_model = &#x27;C:/Users/suso/Desktop/yolov5_fire/best.onnx&#x27;<br>for imgname in os.listdir(&#x27;C:/Users/suso/Desktop/yolov5_fire/test_jpg&#x27;):<br>    print(imgname)<br>    image_path = &#x27;C:/Users/suso/Desktop/yolov5_fire/test_jpg/&#x27;+imgname<br>    frame = cv2.imread(image_path)<br>    helmet_pred,img = helmet_detect(face_model,frame)<br>    print(helmet_pred)<br>    for bbox in helmet_pred:<br>        bbox = helmet_scale_ratio(bbox,frame)#no letterbox<br>        # im_shape = img.shape[2:]<br>        # frame_shape = frame.shape<br>        # bbox = scale_boxes(im_shape, bbox, frame_shape)#add letterbox<br>        drawHelmetBox(frame,bbox)<br><br><br></code></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/myblog/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/myblog/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="-html -onnx -detect" scheme="https://qzpzd.github.io/myblog/tags/html-onnx-detect/"/>
    
  </entry>
  
  <entry>
    <title>butterflyæ•™ç¨‹</title>
    <link href="https://qzpzd.github.io/myblog/2023/07/27/test/"/>
    <id>https://qzpzd.github.io/myblog/2023/07/27/test/</id>
    <published>2023-07-27T07:08:29.000Z</published>
    <updated>2023-10-09T11:05:01.773Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/myblog/css/APlayer.min.css"><script src="/myblog/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/myblog/js/Meting.min.js"></script><h1 id="å¼•ç”¨å—"><a href="#å¼•ç”¨å—" class="headerlink" title="å¼•ç”¨å—"></a>å¼•ç”¨å—</h1><p>æºä»£ç </p><figure class="highlight plaintext"><figcaption><span>[å¼•ç”¨å—]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;blockquote&gt;&lt;p&gt;content  &lt;/p&gt;<br>&lt;footer&gt;&lt;strong&gt;author&lt;/strong&gt;&lt;cite&gt;- source [link] [source_link_title]&lt;/cite&gt;&lt;/footer&gt;&lt;/blockquote&gt;<br></code></pre></td></tr></table></figure><blockquote><p>content  </p><footer><strong>author</strong><cite>- source [link] [source_link_title]</cite></footer></blockquote><p>æºä»£ç </p><figure class="highlight plaintext"><figcaption><span>[å¼•ç”¨å—]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plaintext"><br>&gt;å¼•ç”¨å†…å®¹<br>&gt;&gt;å¼•ç”¨å†…å®¹<br>&gt;&gt;&gt;yyå†…å®¹<br><br></code></pre></td></tr></table></figure><blockquote><p>å¼•ç”¨å†…å®¹</p><blockquote><p>å¼•ç”¨å†…å®¹</p><blockquote><p>yyå†…å®¹</p></blockquote></blockquote></blockquote><h1 id="åˆ†å‰²çº¿"><a href="#åˆ†å‰²çº¿" class="headerlink" title="åˆ†å‰²çº¿"></a>åˆ†å‰²çº¿</h1><p>æºä»£ç </p><figure class="highlight plaintext"><figcaption><span>[åˆ†å‰²çº¿]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext"><br>---<br><br></code></pre></td></tr></table></figure><hr><h1 id="ä»£ç å—"><a href="#ä»£ç å—" class="headerlink" title="ä»£ç å—"></a>ä»£ç å—</h1><p>æºä»£ç </p><figure class="highlight plaintext"><figcaption><span>[ä»£ç å—]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext"><br>&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;figcaption&gt;&lt;span&gt;[title] [lang:language] [url] [link text]&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;hljs plaintext&quot;&gt;  &lt;br&gt;code snippet  &lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;  <br><br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><figcaption><span>[title] [lang:language] [url] [link text]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">  <br>code snippet  <br></code></pre></td></tr></table></figure>  <h1 id="å¼•ç”¨æ–‡ç« é“¾æ¥"><a href="#å¼•ç”¨æ–‡ç« é“¾æ¥" class="headerlink" title="å¼•ç”¨æ–‡ç« é“¾æ¥"></a>å¼•ç”¨æ–‡ç« é“¾æ¥</h1><p>æºä»£ç </p><figure class="highlight plaintext"><figcaption><span>[é“¾æ¥å—]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext"><br>&lt;a href=&quot;/2023/10/09/hello-world/&quot; title=&quot;Hello World&quot;&gt;hello-world&lt;/a&gt; <br><br></code></pre></td></tr></table></figure><a href="/2023/10/09/hello-world/" title="Hello World">hello-world</a><h1 id="é€‰é¡¹å¡"><a href="#é€‰é¡¹å¡" class="headerlink" title="é€‰é¡¹å¡"></a>é€‰é¡¹å¡</h1><p>æºä»£ç </p><figure class="highlight plaintext"><figcaption><span>[é€‰é¡¹å¡]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext"><br>&lt;div class=&quot;tabs&quot; id=&quot;æ ‡ç­¾&quot;&gt;&lt;ul class=&quot;nav-tabs&quot;&gt;&lt;li class=&quot;tab active&quot;&gt;&lt;button type=&quot;button&quot; data-href=&quot;#æ ‡ç­¾-1&quot;&gt;æ ‡ç­¾ 1&lt;/button&gt;&lt;/li&gt;&lt;li class=&quot;tab&quot;&gt;&lt;button type=&quot;button&quot; data-href=&quot;#æ ‡ç­¾-2&quot;&gt;æ ‡ç­¾ 2&lt;/button&gt;&lt;/li&gt;&lt;li class=&quot;tab&quot;&gt;&lt;button type=&quot;button&quot; data-href=&quot;#æ ‡ç­¾-3&quot;&gt;æ ‡ç­¾ä¸‰&lt;/button&gt;&lt;/li&gt;&lt;/ul&gt;&lt;div class=&quot;tab-contents&quot;&gt;&lt;div class=&quot;tab-item-content active&quot; id=&quot;æ ‡ç­¾-1&quot;&gt;&lt;p&gt;&lt;strong&gt;é€‰é¡¹å¡ 1&lt;/strong&gt; &lt;/p&gt;&lt;button type=&quot;button&quot; class=&quot;tab-to-top&quot; aria-label=&quot;scroll to top&quot;&gt;&lt;i class=&quot;fas fa-arrow-up&quot;&gt;&lt;/i&gt;&lt;/button&gt;&lt;/div&gt;&lt;div class=&quot;tab-item-content&quot; id=&quot;æ ‡ç­¾-2&quot;&gt;&lt;p&gt;&lt;strong&gt;é€‰é¡¹å¡ 2&lt;/strong&gt;&lt;/p&gt;&lt;button type=&quot;button&quot; class=&quot;tab-to-top&quot; aria-label=&quot;scroll to top&quot;&gt;&lt;i class=&quot;fas fa-arrow-up&quot;&gt;&lt;/i&gt;&lt;/button&gt;&lt;/div&gt;&lt;div class=&quot;tab-item-content&quot; id=&quot;æ ‡ç­¾-3&quot;&gt;&lt;p&gt;&lt;strong&gt;é€‰é¡¹å¡ 3&lt;/strong&gt; , åå­—ä¸º &lt;code&gt;TABä¸‰&lt;/code&gt;&lt;/p&gt;&lt;button type=&quot;button&quot; class=&quot;tab-to-top&quot; aria-label=&quot;scroll to top&quot;&gt;&lt;i class=&quot;fas fa-arrow-up&quot;&gt;&lt;/i&gt;&lt;/button&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt; <br><br></code></pre></td></tr></table></figure><div class="tabs" id="æ ‡ç­¾"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#æ ‡ç­¾-1">æ ‡ç­¾ 1</button></li><li class="tab"><button type="button" data-href="#æ ‡ç­¾-2">æ ‡ç­¾ 2</button></li><li class="tab"><button type="button" data-href="#æ ‡ç­¾-3">æ ‡ç­¾ä¸‰</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="æ ‡ç­¾-1"><p><strong>é€‰é¡¹å¡ 1</strong> </p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="æ ‡ç­¾-2"><p><strong>é€‰é¡¹å¡ 2</strong></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="æ ‡ç­¾-3"><p><strong>é€‰é¡¹å¡ 3</strong> , åå­—ä¸º <code>TABä¸‰</code></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p>æºä»£ç </p><figure class="highlight plaintext"><figcaption><span>[é€‰é¡¹å¡]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs plaintext"><br>&lt;div class=&quot;gallery-group-main&quot;&gt;<br><br>  &lt;figure class=&quot;gallery-group&quot;&gt;<br>  &lt;img class=&quot;gallery-group-img no-lightbox&quot; src=&#x27;https://api.aqcoder.cntoday&#x27; alt=&quot;Group Image Gallery&quot;&gt;<br>  &lt;figcaption&gt;<br>  &lt;div class=&quot;gallery-group-name&quot;&gt;å£çº¸&lt;/div&gt;<br>  &lt;p&gt;æ”¶è—çš„ä¸€äº›å£çº¸&lt;/p&gt;<br>  &lt;a href=&#x27;/myblog/Gallery/wallpaper/&#x27;&gt;&lt;/a&gt;<br>  &lt;/figcaption&gt;<br>  &lt;/figure&gt;<br>  <br>&lt;/div&gt;<br><br></code></pre></td></tr></table></figure><div class="gallery-group-main">  <figure class="gallery-group">  <img class="gallery-group-img no-lightbox" src='https://api.aqcoder.cntoday' alt="Group Image Gallery">  <figcaption>  <div class="gallery-group-name">å£çº¸</div>  <p>æ”¶è—çš„ä¸€äº›å£çº¸</p>  <a href='/myblog/gallery/wallpaper/'></a>  </figcaption>  </figure>  </div><h1 id="æç¤ºå—"><a href="#æç¤ºå—" class="headerlink" title="æç¤ºå—"></a>æç¤ºå—</h1><p>æºä»£ç </p><figure class="highlight plaintext"><figcaption><span>[æç¤ºå—]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs plaintext"><br>&lt;div class=&quot;note default simple&quot;&gt;&lt;p&gt;default æç¤ºå—&lt;/p&gt;<br>&lt;/div&gt;<br><br>&lt;div class=&quot;note primary simple&quot;&gt;&lt;p&gt;primary æç¤ºå—&lt;/p&gt;<br>&lt;/div&gt;<br><br>&lt;div class=&quot;note success simple&quot;&gt;&lt;p&gt;success æç¤ºå—&lt;/p&gt;<br>&lt;/div&gt;<br><br>&lt;div class=&quot;note info simple&quot;&gt;&lt;p&gt;info æç¤ºå—&lt;/p&gt;<br>&lt;/div&gt;<br><br>&lt;div class=&quot;note warning simple&quot;&gt;&lt;p&gt;warning æç¤ºå—&lt;/p&gt;<br>&lt;/div&gt;<br><br>&lt;div class=&quot;note danger simple&quot;&gt;&lt;p&gt;danger æç¤ºå—&lt;/p&gt;<br>&lt;/div&gt;<br><br></code></pre></td></tr></table></figure><div class="note default simple"><p>default æç¤ºå—</p></div><div class="note primary simple"><p>primary æç¤ºå—</p></div><div class="note success simple"><p>success æç¤ºå—</p></div><div class="note info simple"><p>info æç¤ºå—</p></div><div class="note warning simple"><p>warning æç¤ºå—</p></div><div class="note danger simple"><p>danger æç¤ºå—</p></div>]]></content>
    
    
    <summary type="html">å¯¹butterflyä¸»é¢˜çš„ç®€å•é…ç½®ä»‹ç»</summary>
    
    
    
    
    <category term="-butterfly -æ•™ç¨‹" scheme="https://qzpzd.github.io/myblog/tags/butterfly-%E6%95%99%E7%A8%8B/"/>
    
  </entry>
  
</feed>
